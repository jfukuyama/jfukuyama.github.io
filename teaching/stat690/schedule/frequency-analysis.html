<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Julia Fukuyama" />
  <title>A tiny bit about time series</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">A tiny bit about time series</h1>
  <p class="author">
Julia Fukuyama
  </p>
</div>
<div id="a-tiny-bit-about-time-series" class="slide section level2">
<h1>A tiny bit about time series</h1>
<p>Frequency/time scale analysis (reading:
https://bookdown.org/rdpeng/timeseriesbook/frequency-and-time-scale-analysis.html)</p>
<ul>
<li>Example</li>
</ul>
<ul>
<li>Parseval’s Theorem</li>
</ul>
<ul>
<li>Fourier transform/Fast Fourier Transform</li>
</ul>
<p>Autoregressive processes</p>
<ul>
<li>Process definition</li>
</ul>
<ul>
<li>Autocorrelation function</li>
</ul>
<ul>
<li>Why you can’t use naive standard errors, how to fix it</li>
</ul>
</div>
<div id="example-time-series-dataset" class="slide section level2">
<h1>Example time series dataset</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tsModel)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">data</span>(balt)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>balt<span class="sc">$</span>date <span class="ot">=</span> <span class="fu">as.Date</span>(balt<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>balt_subset <span class="ot">=</span> <span class="fu">subset</span>(balt, date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;1992-01-01&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">&amp;</span> date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>))</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">ggplot</span>(balt_subset) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> tmpd))</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-1-1.png" /></p>
</div>
<div id="modeling-with-cosinesine-functions"
class="slide section level2">
<h1>Modeling with cosine/sine functions</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>lm_year_cos <span class="ot">=</span> <span class="fu">lm</span>(tmpd <span class="sc">~</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">365</span>), <span class="at">data =</span> balt_subset)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>lm_year_cos <span class="sc">%&gt;%</span> tidy</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   term                   estimate std.error statistic p.value
##   &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)                57.9     0.186     312.        0
## 2 cos(time * 2 * pi/365)    -19.2     0.262     -73.1       0</code></pre>
<p>Doesn’t fit exactly, but it gets a lot of the structure:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">resid =</span> <span class="fu">residuals</span>(lm_year_cos), balt_subset),</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">span =</span> .<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="freq-fig/unnamed-chunk-3-1.png" /></p>
</div>
<div class="slide section level2">

<p>Is this a big coefficient? One way to tell is to add in cosine
functions corresponding to different frequencies and compare:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## terms for cosine with one-year and 6-month frequencies</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>lm_year_half_year_cos <span class="ot">=</span> <span class="fu">lm</span>(tmpd <span class="sc">~</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">365</span>),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                           <span class="at">data =</span> balt_subset)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>lm_year_half_year_cos <span class="sc">%&gt;%</span> tidy</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   term                       estimate std.error statistic p.value
##   &lt;chr&gt;                         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)                  57.9       0.185    313.    0     
## 2 cos(time * 2 * pi/365)      -19.2       0.262    -73.2   0     
## 3 cos(time * 2 * pi * 2/365)    0.578     0.262      2.21  0.0273</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">## terms for cosine with one-year, 6-month, 4-month frequencies</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>lm_year_half_third_cos <span class="ot">=</span> <span class="fu">lm</span>(tmpd <span class="sc">~</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">365</span>),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                           <span class="at">data =</span> balt_subset)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>lm_year_half_third_cos <span class="sc">%&gt;%</span> tidy</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   term                       estimate std.error statistic p.value
##   &lt;chr&gt;                         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)                 57.9        0.185  312.      0     
## 2 cos(time * 2 * pi/365)     -19.2        0.262  -73.2     0     
## 3 cos(time * 2 * pi * 2/365)   0.578      0.262    2.21    0.0274
## 4 cos(time * 2 * pi * 3/365)   0.0218     0.262    0.0834  0.934</code></pre>
</div>
<div class="slide section level2">

<p>We can also compare to larger frequencies:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## terms for cosine with one-year, 6-month, 4-month, 4-year frequencies</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>lm_year_half_third_four_cos <span class="ot">=</span> <span class="fu">lm</span>(tmpd <span class="sc">~</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> .<span class="dv">25</span><span class="sc">/</span><span class="dv">365</span>),</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                           <span class="at">data =</span> balt_subset)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>lm_year_half_third_four_cos <span class="sc">%&gt;%</span> tidy</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   term                          estimate std.error statistic  p.value
##   &lt;chr&gt;                            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                    57.9        0.184   316.    0       
## 2 cos(time * 2 * pi/365)        -19.2        0.259   -73.9   0       
## 3 cos(time * 2 * pi * 2/365)      0.583      0.259     2.25  2.47e- 2
## 4 cos(time * 2 * pi * 3/365)      0.0265     0.259     0.102 9.19e- 1
## 5 cos(time * 2 * pi * 0.25/365)  -1.73       0.259    -6.67  3.28e-11</code></pre>
</div>
<div id="adding-sine-terms" class="slide section level2">
<h1>Adding sine terms</h1>
<p>The previous analysis convinced us that the one-year frequency cosine
was a lot more explanatory than the other frequencies. Does it help to
add sine terms as well?</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>lm_year_cos_sin <span class="ot">=</span> <span class="fu">lm</span>(tmpd <span class="sc">~</span> <span class="fu">cos</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">365</span>) <span class="sc">+</span> <span class="fu">sin</span>(time <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">365</span>), <span class="at">data =</span> balt_subset)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>lm_year_cos_sin <span class="sc">%&gt;%</span> tidy</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   term                   estimate std.error statistic   p.value
##   &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)               57.9      0.165     352.  0        
## 2 cos(time * 2 * pi/365)   -19.2      0.233     -82.4 0        
## 3 sin(time * 2 * pi/365)    -5.67     0.233     -24.4 3.62e-116</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">resid =</span> <span class="fu">residuals</span>(lm_year_cos_sin), balt_subset),</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">span =</span> .<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="freq-fig/unnamed-chunk-8-1.png" /></p>
<p>Answer: Yes, cosine + sine with one-year frequencies does a pretty
good job.</p>
</div>
<div id="nyquist-frequency" class="slide section level2">
<h1>Nyquist frequency</h1>
<p>The Nyquist freqency is the highest frequency of variation that the
observed data can provide any information about.</p>
<p>If we have <span class="math inline">\(n\)</span> observations, then
the most number of cycles that we can observe in the time series is
<span class="math inline">\(n / 2\)</span>, or one cycle every other
data point. Another way of saying that is that the Nyquist frequency is
<span class="math inline">\(f = 1/2\)</span>, i.e. a half a cycle per
day or one cycle per 2 days.</p>
<p>The opposite of the Nyquist frequency is the lowest frequency the
data can provide us information about. This is one cycle per <span
class="math inline">\(n\)</span> observations.</p>
</div>
<div id="a-complete-model-of-a-time-series-dataset"
class="slide section level2">
<h1>A complete “model” of a time series dataset</h1>
<p>We can extend the idea behind the sine/cosine models from a couple
slides ago to make a full “model” for the data. It will be <span
class="math display">\[
y_t = a_0 + \left\{ \sum_{p=1}^{n/2-1} a_p \cos(2\pi tp/n) + b_p \sin(2
\pi t p / n) \right\} + a_{n/2} \cos(\pi t)
\]</span> (no <span class="math inline">\(b_{n/2}\)</span> because <span
class="math inline">\(\sin(\pi t) = 0\)</span> for all integer <span
class="math inline">\(t\)</span>).</p>
<p>This model has the same number of parameters as data points, and
since the predictors are not collinear, it will be able to exactly
recreate the <span class="math inline">\(y_t\)</span>’s.</p>
<p>This means it’s not exactly a “model” in the tradition sense, but
more of a transformation of the data from the raw data (<span
class="math inline">\(y_t\)</span>’s) to information about how much of
the signal is concentrated at different frequencies (the <span
class="math inline">\(a_p\)</span>’s and <span
class="math inline">\(b_p\)</span>’s).</p>
</div>
<div id="parsevals-theorem" class="slide section level2">
<h1>Parseval’s theorem</h1>
<p>It turns out that: <span class="math display">\[
\frac{1}{n} \sum_{t=0}^{n-1} (y_t - \bar y)^2 = \sum_{p=1}^{n/2 - 1}
R_p^2 / 2 + a_{n/2}^2
\]</span> where <span class="math inline">\(R_p^2 = a_p^2 +
b_p^2\)</span>.</p>
<p>Therefore, the amount of variance associated with frequency <span
class="math inline">\(p\)</span> is <span class="math inline">\(R_p^2 /
2\)</span>.</p>
</div>
<div id="periodogram" class="slide section level2">
<h1>Periodogram</h1>
<p>We can plot the <span class="math inline">\(R_p^2\)</span> values to
get a better understanding of the data.</p>
<p>The normal way to plot this is to let <span
class="math inline">\(\omega_p = 2\pi p / n\)</span>, and plot <span
class="math display">\[
I(\omega_p) = \frac{n}{4\pi} R^2_p.
\]</span></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="do">## compute the periodogram</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">spectrum</span>(balt_subset<span class="sc">$</span>tmpd)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>spec.out <span class="ot">=</span> <span class="fu">spectrum</span>(balt_subset<span class="sc">$</span>tmpd)</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-9-1.png" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">freq =</span> spec.out<span class="sc">$</span>freq, <span class="at">spec =</span> spec.out<span class="sc">$</span>spec))<span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> freq, <span class="at">y =</span> <span class="fu">log10</span>(spec)))</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-9-2.png" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">freq =</span> spec.out<span class="sc">$</span>freq, <span class="at">spec =</span> spec.out<span class="sc">$</span>spec))<span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> freq, <span class="at">y =</span> <span class="fu">log10</span>(spec))) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">05</span>))</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-9-3.png" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">## finding the max frequency in the raw periodogram</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>max_freq <span class="ot">=</span> spec.out<span class="sc">$</span>freq[<span class="fu">which.max</span>(spec.out<span class="sc">$</span>spec)]</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>max_freq<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 375</code></pre>
</div>
<div id="smoothing-the-periodogram" class="slide section level2">
<h1>Smoothing the periodogram</h1>
<p>Turns out the raw periodogram is not a consistent estimator, but if
it is smoothed it can be
(https://online.stat.psu.edu/stat510/book/export/html/673 for more
information, and for a definition of the modified Daniell kernel used in
the function below).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="do">## compute the smoothed periodogram</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>smoothed_spectrum <span class="ot">=</span> <span class="fu">spec.pgram</span>(balt_subset<span class="sc">$</span>tmpd, <span class="at">spans =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">plot</span>(smoothed_spectrum)</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-11-1.png" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="do">## finding the max frequency in the raw periodogram</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>max_freq <span class="ot">=</span> smoothed_spectrum<span class="sc">$</span>freq[<span class="fu">which.max</span>(smoothed_spectrum<span class="sc">$</span>spec)]</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>max_freq<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 375</code></pre>
</div>
<div id="autoregressive-processes" class="slide section level2">
<h1>Autoregressive processes</h1>
<p>What is an autoregressive process? Idea: Today’s observation is a
function of yesterday’s observation.</p>
<p>The definition of an AR(1) process: <span class="math display">\[
y_t = \alpha y_{t-1} + \epsilon_t
\]</span></p>
<p>An AR(p) process: <span class="math display">\[
y_t = \alpha_1 y_{t-1} + \alpha_2 y_{t-2} + \cdots + \alpha_p y_{t-p} +
\epsilon_t
\]</span></p>
</div>
<div id="simulating-from-an-ar-process" class="slide section level2">
<h1>Simulating from an AR process</h1>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>ts_out_1 <span class="ot">=</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> .<span class="dv">9</span>), <span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>ts_out_2 <span class="ot">=</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">1</span>)), <span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="fu">plot</span>(ts_out_1)</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-13-1.png" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">plot</span>(ts_out_2)</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-13-2.png" /></p>
</div>
<div
id="why-you-cant-use-normal-confidence-intervals-with-time-series-data"
class="slide section level2">
<h1>Why you can’t use normal confidence intervals with time series
data</h1>
<p>Suppose we wanted to check whether the mean of the process
<code>ts_out_1</code> is equal to 0.</p>
<p>Marginally, each observation in an AR process has a normal
distribution, so if you didn’t realize there was dependence you might be
tempted to use normal-theory confidence intervals for the mean.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">t.test</span>(ts_out_1)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  ts_out_1
## t = -4.3071, df = 999, p-value = 1.817e-05
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  -0.4168455 -0.1559012
## sample estimates:
##  mean of x 
## -0.2863733</code></pre>
<p>In this case we get a very significant result even though we
simulated this dataset and know that it has mean zero. You can check
that the same is true of most other intervals. The problem is that the
samples are not independent of each other and so the conditions required
for the test/confidence intervals are not met.</p>
</div>
<div id="checking-for-autocorrelation" class="slide section level2">
<h1>Checking for autocorrelation</h1>
<p>Can plot the autocorrelation function:</p>
<ul>
<li>ACF(1) is the correlation between the <span
class="math inline">\(n-1\)</span> pairs <span
class="math inline">\(x(t), x(t-1)\)</span></li>
</ul>
<ul>
<li>ACF(m) is the correlation between all <span class="math inline">\(n
- m\)</span> pairs <span class="math inline">\(x(t),
x(t-m)\)</span></li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">acf</span>(ts_out_1)</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-15-1.png" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">acf</span>(ts_out_2)</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-15-2.png" /></p>
<p>The dashed lines are where we can expect the ACF values to fall if
the variables are all uncorrelated.</p>
<p>We can check by comparing to what the ACF looks like if we compute it
for independent observations:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>))</span></code></pre></div>
<p><img src="freq-fig/unnamed-chunk-16-1.png" /></p>
</div>
<div
id="simple-correction-for-standard-errors-with-autoregressive-process"
class="slide section level2">
<h1>Simple correction for standard errors with autoregressive
process</h1>
<p>One thing that you can do to correct this problem is to use the
effective sample size (ESS) instead of the actual sample size when
computing standard errors.</p>
<p>Idea behind ESS: the size of an iid sample that would give the same
standard error. There are several different formulations with slightly
different assumptions. They are commonly used in MCMC.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="fu">effectiveSize</span>(ts_out_1)</span></code></pre></div>
<pre><code>##     var1 
## 64.79996</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">effectiveSize</span>(ts_out_2)</span></code></pre></div>
<pre><code>##     var1 
## 221.4042</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">effectiveSize</span>(<span class="fu">rnorm</span>(<span class="dv">1024</span>))</span></code></pre></div>
<pre><code>## var1 
## 1024</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="do">## compute the se for ts_out_1 with the effective sample size instead of the actual sample size</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>se1 <span class="ot">=</span> <span class="fu">sd</span>(ts_out_1) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">effectiveSize</span>(ts_out_1))</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>mean1 <span class="ot">=</span> <span class="fu">mean</span>(ts_out_1)</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="fu">c</span>(mean1 <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se1, mean1 <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se1)</span></code></pre></div>
<pre><code>##       var1       var1 
## -0.7983051  0.2255584</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="do">## same thing for ts_out_2</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>se2 <span class="ot">=</span> <span class="fu">sd</span>(ts_out_2) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">effectiveSize</span>(ts_out_2))</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>mean2 <span class="ot">=</span> <span class="fu">mean</span>(ts_out_2)</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="fu">c</span>(mean2 <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se2, mean2 <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se2)</span></code></pre></div>
<pre><code>##       var1       var1 
## -0.1906754  0.1336417</code></pre>
</div>
<div id="summing-up" class="slide section level2">
<h1>Summing up</h1>
<p>Frequency analysis: we can make a transformation that tells us about
how much of the variance in a time series is contained in different
frequencies.</p>
<p>Correlation in time series processes: can really screw up standard
errors, can check for it using the autocorrelation function, can usually
fix it by using an effective sample size instead of the actual sample
size.</p>
<p>There is a lot more about modeling time series. You should take a
class or read a book if you want to learn more.</p>
</div>
</body>
</html>
