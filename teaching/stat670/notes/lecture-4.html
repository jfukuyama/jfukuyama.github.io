<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Julia Fukuyama" />
  <title>Stat 470/670 Lecture 4</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Stat 470/670 Lecture 4</h1>
  <p class="author">
Julia Fukuyama
  </p>
</div>
<div id="today" class="slide section level2">
<h1>Today</h1>
<ul>
<li>Review some of the computational tools</li>
</ul>
<ul>
<li>Transformations</li>
</ul>
<p>Reading: R for data science chapters <a
href="https://r4ds.had.co.nz/tibbles.html">10</a> and <a
href="https://r4ds.had.co.nz/tidy-data.html">12</a>, Cleveland
pp. 42–67.</p>
</div>
<div id="computational-interlude-data-structures-in-r"
class="slide section level2">
<h1>Computational Interlude: Data structures in R</h1>
<p>Three main ways to store data</p>
<ul>
<li>Matrix: Requires all the elements to be of the same type
(e.g. numeric or character)</li>
</ul>
<ul>
<li>Data frame: Allows for mixed types of variables</li>
</ul>
<ul>
<li>Tibble: Like a data frame, but works more consistently</li>
</ul>
</div>
<div id="tibbles" class="slide section level2">
<h1>Tibbles</h1>
<p>Tibbles are a better version of data frames.</p>
<p>The <a href="https://tibble.tidyverse.org/">documentation</a>
describes them as “data.frames for the lazy and surly: they do less
(i.e. they don’t change variable names or types, and don’t do partial
matching) and complain more (e.g. when a variable does not exist).”</p>
<p>Two other advantages:</p>
<ul>
<li>They subset more consistently: when you use square brackets to
subset a tibble, you always get another tibble. With data frames you
sometimes get a vector and sometimes get a data frame.</li>
</ul>
<ul>
<li>They print more elegantly.</li>
</ul>
<p>Base R functions, including those for data frames, try to guess what
you want to do.</p>
<p>This sometimes leads to unexpected outcomes, so tibbles have done
away with most of that.</p>
</div>
<div id="tibbles-dont-change-names" class="slide section level2">
<h1>Tibbles don’t change names</h1>
<div class="incremental">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">df =</span> <span class="fu">data.frame</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;b 2&quot;</span> <span class="ot">=</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>##   a b.2
## 1 1   5
## 2 2   4
## 3 3   3
## 4 4   2
## 5 5   1</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">ti =</span> <span class="fu">tibble</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;b 2&quot;</span> <span class="ot">=</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##       a `b 2`
##   &lt;int&gt; &lt;int&gt;
## 1     1     5
## 2     2     4
## 3     3     3
## 4     4     2
## 5     5     1</code></pre>
</div>
</div>
<div id="tibbles-complain-about-bad-column-names"
class="slide section level2">
<h1>Tibbles complain about bad column names</h1>
<div class="incremental">
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ti<span class="sc">$</span>c</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `c`.</code></pre>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="tibbles-subset-consistently" class="slide section level2">
<h1>Tibbles subset consistently</h1>
<div class="incremental">
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ti[,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##       a
##   &lt;int&gt;
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5</code></pre>
</div>
</div>
<div id="tibbles-dont-do-partial-matching" class="slide section level2">
<h1>Tibbles don’t do partial matching</h1>
<div class="incremental">
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>b</span></code></pre></div>
<pre><code>## [1] 5 4 3 2 1</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ti<span class="sc">$</span>b</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `b`.</code></pre>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="two-more-useful-data-wrangling-functions"
class="slide section level2">
<h1>Two more useful data wrangling functions</h1>
<p>Separate:</p>
<ul>
<li>Pulls one column apart into multiple columns.</li>
<li>Splits the values in the column based on a separator.</li>
<li>Default separator is all the non-alphanumeric characters.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>separate</span></code></pre></div>
<pre><code>## function (data, col, into, sep = &quot;[^[:alnum:]]+&quot;, remove = TRUE, 
##     convert = FALSE, extra = &quot;warn&quot;, fill = &quot;warn&quot;, ...) 
## {
##     ellipsis::check_dots_used()
##     UseMethod(&quot;separate&quot;)
## }
## &lt;bytecode: 0x7fd471b385c0&gt;
## &lt;environment: namespace:tidyr&gt;</code></pre>
<div class="incremental">
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">df_test =</span> <span class="fu">data.frame</span>(<span class="at">t =</span> <span class="fu">c</span>(<span class="st">&quot;a b&quot;</span>, <span class="st">&quot;a c&quot;</span>, <span class="st">&quot;a c d&quot;</span>)))</span></code></pre></div>
<pre><code>##       t
## 1   a b
## 2   a c
## 3 a c d</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_test <span class="sc">%&gt;%</span> <span class="fu">separate</span>(t, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;position 1&quot;</span>, <span class="st">&quot;position 2&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 1 rows [3].</code></pre>
<pre><code>##   position 1 position 2
## 1          a          b
## 2          a          c
## 3          a          c</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_test <span class="sc">%&gt;%</span> <span class="fu">separate</span>(t, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;position 1&quot;</span>, <span class="st">&quot;position 2&quot;</span>, <span class="st">&quot;position 3&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 2 rows [1, 2].</code></pre>
<pre><code>##   position 1 position 2 position 3
## 1          a          b       &lt;NA&gt;
## 2          a          c       &lt;NA&gt;
## 3          a          c          d</code></pre>
</div>
</div>
<div class="slide section level2">

<p>Mutate:</p>
<ul>
<li>Creates new variables as functions of existing variables.</li>
<li>First argument is the data.</li>
<li>Subsequent arguments: name of the argument is what you want the new
column name to be. Value of the argument is an expression giving a
transformation of the existing variables (column names) in the data
set.</li>
</ul>
<div class="incremental">
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">df_test =</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">sample</span>(<span class="dv">10</span>), <span class="at">b =</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
<pre><code>##     a  b
## 1   4  8
## 2   7  8
## 3   3  5
## 4   9  4
## 5   2 10
## 6   1  3
## 7   8 10
## 8  10  7
## 9   5  8
## 10  6  3</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sum =</span> a <span class="sc">+</span> b, <span class="at">log_ratio =</span> <span class="fu">log</span>(a <span class="sc">/</span> b))</span></code></pre></div>
<pre><code>##     a  b sum  log_ratio
## 1   4  8  12 -0.6931472
## 2   7  8  15 -0.1335314
## 3   3  5   8 -0.5108256
## 4   9  4  13  0.8109302
## 5   2 10  12 -1.6094379
## 6   1  3   4 -1.0986123
## 7   8 10  18 -0.2231436
## 8  10  7  17  0.3566749
## 9   5  8  13 -0.4700036
## 10  6  3   9  0.6931472</code></pre>
</div>
</div>
<div id="example" class="slide section level2">
<h1>Example</h1>
<p>Let’s read in a .csv file on lengths of Billboard Hot 100 songs in
2000:</p>
<div class="incremental">
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://github.com/hadley/tidy-data/raw/master/data/billboard.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 317 Columns: 83
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr   (3): artist.inverted, track, genre
## dbl  (66): year, x1st.week, x2nd.week, x3rd.week, x4th.week, x5th.week, x6th...
## lgl  (11): x66th.week, x67th.week, x68th.week, x69th.week, x70th.week, x71st...
## date  (2): date.entered, date.peaked
## time  (1): time
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>billboard_standard <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://github.com/hadley/tidy-data/raw/master/data/billboard.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>billboard_tidy</span></code></pre></div>
<pre><code>## # A tibble: 317 × 83
##     year artis…¹ track time  genre date.ent…² date.pea…³ x1st.…⁴ x2nd.…⁵ x3rd.…⁶
##    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;tim&gt; &lt;chr&gt; &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1  2000 Destin… Inde… 03:38 Rock  2000-09-23 2000-11-18      78      63      49
##  2  2000 Santana Mari… 04:18 Rock  2000-02-12 2000-04-08      15       8       6
##  3  2000 Savage… I Kn… 04:07 Rock  1999-10-23 2000-01-29      71      48      43
##  4  2000 Madonna Music 03:45 Rock  2000-08-12 2000-09-16      41      23      18
##  5  2000 Aguile… Come… 03:38 Rock  2000-08-05 2000-10-14      57      47      45
##  6  2000 Janet   Does… 04:17 Rock  2000-06-17 2000-08-26      59      52      43
##  7  2000 Destin… Say … 04:31 Rock  1999-12-25 2000-03-18      83      83      44
##  8  2000 Iglesi… Be W… 03:36 Latin 2000-04-01 2000-06-24      63      45      34
##  9  2000 Sisqo   Inco… 03:52 Rock  2000-06-24 2000-08-12      77      66      61
## 10  2000 Lonest… Amaz… 04:25 Coun… 1999-06-05 2000-03-04      81      54      44
## # … with 307 more rows, 73 more variables: x4th.week &lt;dbl&gt;, x5th.week &lt;dbl&gt;,
## #   x6th.week &lt;dbl&gt;, x7th.week &lt;dbl&gt;, x8th.week &lt;dbl&gt;, x9th.week &lt;dbl&gt;,
## #   x10th.week &lt;dbl&gt;, x11th.week &lt;dbl&gt;, x12th.week &lt;dbl&gt;, x13th.week &lt;dbl&gt;,
## #   x14th.week &lt;dbl&gt;, x15th.week &lt;dbl&gt;, x16th.week &lt;dbl&gt;, x17th.week &lt;dbl&gt;,
## #   x18th.week &lt;dbl&gt;, x19th.week &lt;dbl&gt;, x20th.week &lt;dbl&gt;, x21st.week &lt;dbl&gt;,
## #   x22nd.week &lt;dbl&gt;, x23rd.week &lt;dbl&gt;, x24th.week &lt;dbl&gt;, x25th.week &lt;dbl&gt;,
## #   x26th.week &lt;dbl&gt;, x27th.week &lt;dbl&gt;, x28th.week &lt;dbl&gt;, x29th.week &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>billboard_standard[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span></code></pre></div>
<pre><code>##    year     artist.inverted                                 track time   genre
## 1  2000     Destiny&#39;s Child              Independent Women Part I 3:38    Rock
## 2  2000             Santana                          Maria, Maria 4:18    Rock
## 3  2000       Savage Garden                    I Knew I Loved You 4:07    Rock
## 4  2000             Madonna                                 Music 3:45    Rock
## 5  2000 Aguilera, Christina Come On Over Baby (All I Want Is You) 3:38    Rock
## 6  2000               Janet                 Doesn&#39;t Really Matter 4:17    Rock
## 7  2000     Destiny&#39;s Child                           Say My Name 4:31    Rock
## 8  2000   Iglesias, Enrique                           Be With You 3:36   Latin
## 9  2000               Sisqo                            Incomplete 3:52    Rock
## 10 2000            Lonestar                                Amazed 4:25 Country
##    date.entered date.peaked x1st.week
## 1    2000-09-23  2000-11-18        78
## 2    2000-02-12  2000-04-08        15
## 3    1999-10-23  2000-01-29        71
## 4    2000-08-12  2000-09-16        41
## 5    2000-08-05  2000-10-14        57
## 6    2000-06-17  2000-08-26        59
## 7    1999-12-25  2000-03-18        83
## 8    2000-04-01  2000-06-24        63
## 9    2000-06-24  2000-08-12        77
## 10   1999-06-05  2000-03-04        81</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(billboard_tidy<span class="sc">$</span>date.entered)</span></code></pre></div>
<pre><code>##         Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
## &quot;1999-06-05&quot; &quot;2000-02-05&quot; &quot;2000-04-29&quot; &quot;2000-05-03&quot; &quot;2000-08-12&quot; &quot;2000-12-30&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(billboard_standard<span class="sc">$</span>date.entered)</span></code></pre></div>
<pre><code>##    Length     Class      Mode 
##       317 character character</code></pre>
</div>
</div>
<div id="how-long-are-songs" class="slide section level2">
<h1>How long are songs?</h1>
<p>How long were the songs on the 2000 Hot 100? The display shows that
<code>time</code> is formatted as time. This seems great, but
unfortunately there’s been a mistake:</p>
<div class="incremental">
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy<span class="sc">$</span>time[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## 03:38:00</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy<span class="sc">$</span>time[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## 04:18:00</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy<span class="sc">$</span>time[<span class="dv">2</span>] <span class="sc">-</span> billboard_tidy<span class="sc">$</span>time[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## Time difference of 2400 secs</code></pre>
</div>
</div>
<div class="slide section level2">

<p>We’ll have to go back and fix this: we can specify the type for a
certain column by using the col_types argument. We’ll read the times in
as characters and parse them ourselves.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://github.com/hadley/tidy-data/raw/master/data/billboard.csv&quot;</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">time =</span> <span class="fu">col_character</span>()))</span></code></pre></div>
<div class="incremental">
<p>I’ll show you how to do this two ways, with and without pipes (the
<code>%&gt;%</code> function in the <code>magrittr</code> package).</p>
</div>
</div>
<div class="slide section level2">

<p>First let’s try without pipes.</p>
<p>We need to separate the time into minutes and seconds. For this we
can use separate:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>billboard_min_sec <span class="ot">=</span> <span class="fu">separate</span>(billboard_tidy, time,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;minutes&quot;</span>, <span class="st">&quot;seconds&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="incremental">
<p>We can look the columns we have created, plus the original column, to
make sure the operation was performed correctly. To look at just a
couple of columns, we can use select:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(billboard_min_sec, time, minutes, seconds)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 3
##    time  minutes seconds
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
##  1 3:38  3       38     
##  2 4:18  4       18     
##  3 4:07  4       07     
##  4 3:45  3       45     
##  5 3:38  3       38     
##  6 4:17  4       17     
##  7 4:31  4       31     
##  8 3:36  3       36     
##  9 3:52  3       52     
## 10 4:25  4       25     
## # … with 307 more rows</code></pre>
</div>
</div>
<div class="slide section level2">

<p>Then we need to add minutes and seconds together to get time in
minutes. For this we can use mutate:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>billboard_time_in_sec <span class="ot">=</span> <span class="fu">mutate</span>(billboard_min_sec,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_in_seconds =</span> <span class="fu">as.numeric</span>(minutes) <span class="sc">*</span> <span class="dv">60</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(seconds))</span></code></pre></div>
<div class="incremental">
<p>Again, let’s look at the tibble to make sure the operation was done
right:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(billboard_time_in_sec, time, minutes, seconds, time_in_seconds)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 4
##    time  minutes seconds time_in_seconds
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;
##  1 3:38  3       38                  218
##  2 4:18  4       18                  258
##  3 4:07  4       07                  247
##  4 3:45  3       45                  225
##  5 3:38  3       38                  218
##  6 4:17  4       17                  257
##  7 4:31  4       31                  271
##  8 3:36  3       36                  216
##  9 3:52  3       52                  232
## 10 4:25  4       25                  265
## # … with 307 more rows</code></pre>
</div>
</div>
<div id="repeating-the-code-from-before-with-pipes"
class="slide section level2">
<h1>Repeating the code from before with pipes</h1>
<p>Let’s see how this changes the code we used above.</p>
<p>Remember that we had</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>billboard_min_sec <span class="ot">=</span> <span class="fu">separate</span>(billboard_tidy, time,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;minutes&quot;</span>, <span class="st">&quot;seconds&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>billboard_time_in_sec <span class="ot">=</span> <span class="fu">mutate</span>(billboard_min_sec,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_in_seconds =</span> <span class="fu">as.numeric</span>(minutes) <span class="sc">*</span> <span class="dv">60</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(seconds))</span></code></pre></div>
<div class="incremental">
<p>Or equivalently, without making an intermediate tibble:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>billboard_time_in_sec <span class="ot">=</span> <span class="fu">mutate</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(billboard_tidy, time, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;minutes&quot;</span>, <span class="st">&quot;seconds&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_in_seconds =</span> <span class="fu">as.numeric</span>(minutes) <span class="sc">*</span> <span class="dv">60</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(seconds))</span></code></pre></div>
</div>
<div class="incremental">
<p>With pipes, the same operations are:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="ot">=</span> billboard_tidy <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(time, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;minutes&quot;</span>, <span class="st">&quot;seconds&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_in_seconds =</span> <span class="fu">as.numeric</span>(minutes) <span class="sc">*</span> <span class="dv">60</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(seconds))</span></code></pre></div>
</div>
</div>
<div id="back-to-data-analysis-how-long-are-the-songs"
class="slide section level2">
<h1>Back to data analysis: how long are the songs?</h1>
<p>Now that we have our dataset in a nice format, let’s try looking at
the distribution of song lengths:</p>
<div class="incremental">
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billboard, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">2.5</span>, <span class="dv">8</span>, <span class="at">by =</span> .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time in Minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-18-1.png" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billboard, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>() <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">2.5</span>, <span class="dv">8</span>, <span class="at">by =</span> .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time in Minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-18-2.png" /></p>
<p>The majority of Hot 100 songs (about three quarters) are between 3:15
and 4:30.</p>
</div>
</div>
<div class="slide section level2">

<p>But maybe we’re unfairly penalizing songs that are on the charts for
a long time: they’re only represented once in our histogram even though
they are in the top 100 for multiple weeks.</p>
<div class="incremental">
<p>If we want to investigate this, we need to make one row in our tibble
for each week:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>billboard_long <span class="ot">=</span> billboard <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(x1st.week<span class="sc">:</span>x76th.week, <span class="at">names_to =</span> <span class="st">&quot;week&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;rank&quot;</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>billboard_long</span></code></pre></div>
<pre><code>## # A tibble: 5,307 × 12
##     year artis…¹ track time  minutes seconds genre date.ent…² date.pea…³ time_…⁴
##    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;
##  1  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  2  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  3  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  4  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  5  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  6  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  7  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  8  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
##  9  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
## 10  2000 Destin… Inde… 3:38  3       38      Rock  2000-09-23 2000-11-18     218
## # … with 5,297 more rows, 2 more variables: week &lt;chr&gt;, rank &lt;dbl&gt;, and
## #   abbreviated variable names ¹​artist.inverted, ²​date.entered, ³​date.peaked,
## #   ⁴​time_in_seconds</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">## why are there 5307 observations? Shouldn&#39;t there be 5200 (52 weeks times 100 songs)?</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billboard_long, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fl">2.5</span>, <span class="dv">8</span>, <span class="at">by =</span> .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time in Minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-19-1.png" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billboard_long, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>() <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">2.5</span>, <span class="dv">8</span>, <span class="at">by =</span> .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time in Minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-19-2.png" /></p>
</div>
<div class="incremental">
<p>The <span class="math inline">\(y\)</span>-axis scale has changed
(since there are more observations.) However, the shape of the
distributions are pretty much the same, suggesting that weighting by
number of weeks on the chart doesn’t make much difference.</p>
</div>
</div>
<div id="does-song-length-change-by-rank" class="slide section level2">
<h1>Does song length change by rank?</h1>
<p>Another question we might be interested in is whether the length of
the songs changes with rank. As a first stab at this, we can facet by
chart position. To avoid drawing 100 graphs, we use
<code>subset()</code> to only consider the top 10 chart positions:</p>
<div class="incremental">
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">=</span> billboard_long <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(rank <span class="sc">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>() <span class="sc">+</span>  <span class="fu">geom_rug</span>() <span class="sc">+</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> rank, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time in minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-20-1.png" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>, <span class="at">fill =</span> <span class="fu">as.factor</span>(rank))) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span>  <span class="fu">geom_rug</span>() <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time in minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-20-2.png" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> rank, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time in minutes&quot;</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lecture-4-fig/unnamed-chunk-20-3.png" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>, <span class="at">fill =</span> <span class="fu">as.factor</span>(rank))) <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time in minutes&quot;</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lecture-4-fig/unnamed-chunk-20-4.png" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ecdf</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> rank) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time in minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-20-5.png" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10, <span class="fu">aes</span>(<span class="at">x =</span> time_in_seconds <span class="sc">/</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ecdf</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">as.factor</span>(rank))) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time in minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-20-6.png" /></p>
<p>Which plot do you think makes it the easiest to compare the
distributions?</p>
</div>
</div>
<div id="using-simpler-summaries-to-visualize-length-by-chart-position"
class="slide section level2">
<h1>Using simpler summaries to visualize length by chart position</h1>
<p>Finally, let’s find mean song length by chart position.</p>
<p>This will allow us to compare all 100 chart positions instead of just
the first 10.</p>
<div class="incremental">
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mean_times <span class="ot">=</span> billboard_long <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(rank) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">avg_time_in_minutes =</span> <span class="fu">mean</span>(time_in_seconds) <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="do">## remember this is the same as</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>mean_times_alt <span class="ot">=</span> <span class="fu">summarise</span>(<span class="fu">group_by</span>(billboard_long, rank),</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_time_in_minutes =</span> <span class="fu">mean</span>(time_in_seconds) <span class="sc">/</span> <span class="dv">60</span>)</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mean_times, <span class="fu">aes</span>(<span class="at">x =</span> rank, <span class="at">y =</span> avg_time_in_minutes)) <span class="sc">+</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Average time in minutes&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-22-1.png" /></p>
<p>There is enough noise here that it’s hard to see if there’s a
relationship between rank and song length. Later on we’ll learn a bit
about <em>smoothing</em>, which would help a lot here.</p>
</div>
</div>
<div id="transformations" class="slide section level2">
<h1>Transformations</h1>
<p>Reading: Cleveland pp. 42–67.</p>
</div>
<div id="log-transformation" class="slide section level2">
<h1>Log transformation</h1>
<p>In an intro course like S320/520, you learned to use the most common
transformation, the log.</p>
<ul>
<li>The main reason we gave was that it often made positive data more
normal.</li>
</ul>
<ul>
<li>Taking logs amounts to changing the units of the data in such a way
that equal differences now mean equal multiplicative factors. This
simplifies the interpretation of the measurement scale because addition
is easier than multiplication.</li>
</ul>
<ul>
<li>Some statisticians will go as far as to recommend log transforming
positive data by default, though by the end of Cleveland’s chapter 2,
we’ll see an example where that backfires.</li>
</ul>
</div>
<div id="power-transformations" class="slide section level2">
<h1>Power transformations</h1>
<p>The log transformation doesn’t always work – for a start, you can’t
log zero or a negative number.</p>
<p><strong>Power transformations</strong> allow a wider range of
options.</p>
<p>Define a power transformation with parameter <span
class="math inline">\(\tau\)</span> to be <span
class="math inline">\(x^\tau\)</span>.</p>
<p>Where practical, we’ll hugely prefer <span class="math inline">\(\tau
= 1\)</span> (no transformation), <span class="math inline">\(\tau =
0\)</span>, or possibly <span class="math inline">\(\tau = -1\)</span>
(inverse transformation) because they’re much easier to interpret.</p>
</div>
<div id="box-cox-transformation" class="slide section level2">
<h1>Box-Cox transformation</h1>
<p>You might also see Box-Cox transformations: these are really just
power transformations, but re-scaled so that they go continuously to the
log transform as <span class="math inline">\(\tau \to 0\)</span> on
either side.</p>
<p>Let <span class="math inline">\(x\)</span> be the original data
value, and let <span class="math inline">\(f_\tau\)</span> be the
Box-Cox transformation with parameter <span
class="math inline">\(\tau\)</span>. It is defined as:</p>
<p><span class="math display">\[
f_\tau(x) = \begin{cases}
\frac{x^{\tau} - 1}{\tau} &amp; \tau \ne 0\\
\log x &amp; \tau = 0
\end{cases}
\]</span></p>
</div>
<div class="slide section level2">

<p>Here’s a little picture of the transformations, note how the log
transformation floats nicely in between the negative and positive values
of <span class="math inline">\(\tau\)</span>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>bc_trans <span class="ot">=</span> <span class="cf">function</span>(x, tau) {</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(tau <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">log</span>(x))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((x<span class="sc">^</span>tau <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> tau)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>tau_vec <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span>.<span class="dv">4</span>, <span class="fl">1.4</span>, <span class="at">by =</span> .<span class="dv">2</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>transforms <span class="ot">=</span> <span class="fu">sapply</span>(tau_vec, <span class="cf">function</span>(tau) <span class="fu">bc_trans</span>(x, tau))</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>transforms_melted <span class="ot">=</span> <span class="fu">melt</span>(transforms)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>transforms_for_plotting <span class="ot">=</span> transforms_melted <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">x =</span> x[Var1], <span class="at">tau =</span> tau_vec[Var2])</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transforms_for_plotting) <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">color =</span> <span class="fu">as.factor</span>(tau))) <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Original Data Value&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Transformed Value&quot;</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-23-1.png" /></p>
</div>
<div id="lets-see-how-these-work-on-real-data"
class="slide section level2">
<h1>Let’s see how these work on real data</h1>
<p>Load <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>We’ll also use an R workspace prepared by Cleveland to use in
conjunction with the book. Among other things, this contains the data
sets used in the book.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;lattice.RData&quot;</span>)</span></code></pre></div>
<p>We’ll use the stereogram fusion time data in
<code>fusion.time</code>, which contains the group variable
<code>nv.vv</code> (where “NV” means no visual information and “VV”
means visual information) and the quantitative variable
<code>time</code> (a positive number.)</p>
</div>
<div id="power-transformations-on-fusion-time-data"
class="slide section level2">
<h1>Power transformations on fusion time data</h1>
<p>Let’s try some of the power transformations on the fusion time data —
we would like to see which gives a distribution closest to normal.
(Why?)</p>
<p>We’ll just look at the VV times for now.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>vv <span class="ot">=</span> fusion.time <span class="sc">%&gt;%</span> <span class="fu">subset</span>(nv.vv <span class="sc">==</span> <span class="st">&quot;VV&quot;</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>tau_vec <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">25</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>transforms <span class="ot">=</span> <span class="fu">sapply</span>(tau_vec, <span class="cf">function</span>(tau) <span class="fu">bc_trans</span>(vv<span class="sc">$</span>time, tau))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>transforms_melted <span class="ot">=</span> <span class="fu">melt</span>(transforms)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>transforms_for_plotting <span class="ot">=</span> transforms_melted <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tau =</span> tau_vec[Var2])</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transforms_for_plotting) <span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq</span>(<span class="fu">aes</span>(<span class="at">sample =</span> value)) <span class="sc">+</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> tau, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="lecture-4-fig/unnamed-chunk-26-1.png" /></p>
<p>Here <span class="math inline">\(\tau\)</span>-values of <span
class="math inline">\(0\)</span> (the log transformation) and <span
class="math inline">\(-0.25\)</span> give the straightest Q-normal
plots.</p>
<p>Since it’s much, much easier to interpret <span
class="math inline">\(\log(x)\)</span> than <span
class="math inline">\(x^{-0.25}\)</span>, we strongly prefer the log
transformation.</p>
</div>
<div id="theoretical-reasons-for-transformations"
class="slide section level2">
<h1>Theoretical reasons for transformations</h1>
<p>In your more theoretical statistics courses, you might come across
<em>variance-stabilizing transformations</em>.</p>
<p>In real data, we often see that the variance depends on the mean.</p>
<div class="incremental">
<p>For example, if <span class="math inline">\(X\)</span> is distributed
<span class="math inline">\(\text{Poisson}(\lambda)\)</span>, <span
class="math inline">\(E_\lambda(X) = \lambda\)</span>, and <span
class="math inline">\(\text{Var}_\lambda(X) = \lambda\)</span>.</p>
<p>For Poisson random variables, the square root transformation (<span
class="math inline">\(\tau = 1/2\)</span>) is approximately variance
stabilizing, that is, <span class="math inline">\(X^{1/2}\)</span> will
have variance that is about the same no matter what <span
class="math inline">\(\lambda\)</span> is.</p>
<p>Conut data often have a Poisson distribution, and so it is often
useful to use a square root transformation for counts.</p>
<blockquote>
<p>The re-expressions most frequently useful for counts are logs and
(square) roots. In fact, it is rather hard to find a set of counts that
are better analyzed as raw counts than as root counts.</p>
</blockquote>
<p>Tukey, EDA, p. 83-84</p>
</div>
<div class="incremental">
<p>If we have random variables <span class="math inline">\(X_i\)</span>,
with <span class="math inline">\(E(X_i) = \mu\)</span> and <span
class="math inline">\(\text{Var}(X_i) = s^2 \mu^2\)</span> (the standard
deviation is proportional to the mean), then the log transformation
(<span class="math inline">\(\tau = 0\)</span>) is approximately
variance stabilizing.</p>
</div>
</div>
<div id="next-time" class="slide section level2">
<h1>Next time</h1>
<p>Putting everything together to build simple models.</p>
</div>
</body>
</html>
