<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>lecture09</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div
id="more-on-data-manipulation-shape-changing-merging-transformations"
class="slide section level2">
<h1>More on data manipulation, shape changing, merging,
transformations</h1>
<p>Reading: Hadley Wickham, <a
href="http://vita.had.co.nz/papers/tidy-data.pdf">“Tidy Data”</a></p>
<p>Agenda for today:</p>
<ul class="incremental">
<li><p>Reshaping/tidy data/wide vs. long format</p></li>
<li><p>Merging</p></li>
</ul>
</div>
<div id="tidy-data" class="slide section level2">
<h1>Tidy data</h1>
<p>We usually want our data in the folowing form:</p>
<ul class="incremental">
<li><p>In a rectangular data frame</p></li>
<li><p>One row per observation</p></li>
</ul>
<p>Data don’t always come this way!</p>
<div class="incremental">
<p>Even if the data do satisfy the “one row per observation” rule for
one analysis, they don’t necessarily do so for another, and we often
need to change the “shape” of the data.</p>
</div>
</div>
<div id="data-semantics" class="slide section level2">
<h1>Data semantics</h1>
<p>Three concepts:</p>
<ul class="incremental">
<li><p>Values</p></li>
<li><p>Variables</p></li>
<li><p>Observations</p></li>
</ul>
<p>Datasets contain <em>values</em>, each of which belongs to a
<em>variable</em> and an <em>observation</em>.</p>
</div>
<div class="slide section level2">

<p>Datasets can encode these in a lot of different ways. The “tidy” way
is to have</p>
<ul class="incremental">
<li><p>Each variable a column</p></li>
<li><p>Each observation a row</p></li>
<li><p>Each cell a value</p></li>
</ul>
<p>This is usually the way that other functions want the data to come
in.</p>
</div>
<div class="slide section level2">

<p>For example:</p>
<p><img src="treatment-wide.png" /></p>
<p>What is easy to do with data in this format?</p>
<ul class="incremental">
<li><p>See which treatment worked better for each individual.</p></li>
<li><p>Run a paired t-test on treatment a vs. treatment b.</p></li>
</ul>
<p>What is hard to do with data in this format?</p>
<ul class="incremental">
<li><p>Run a linear model with result modeled as a function of
treatment.</p></li>
<li><p>Subset the data to the observations corresponding to a specific
treatment (not hard so much as not programmatically nice).</p></li>
</ul>
</div>
<div class="slide section level2">

<p>Same information:</p>
<p><img src="treatment-long.png" /></p>
<p>What is easy to do with data in this format?</p>
<ul class="incremental">
<li><p>Run a linear model with result modeled as a function of
treatment.</p></li>
<li><p>Subset to observations corresponding to one treatment.</p></li>
</ul>
<p>What is hard?</p>
<ul class="incremental">
<li><p>Compute treatment a - treatment b.</p></li>
<li><p>Run a paired t-test.</p></li>
</ul>
</div>
<div class="slide section level2">

<p>Another example:</p>
<p><img src="tb-wide.png" /></p>
<p>Easy:</p>
<ul class="incremental">
<li><p>See overall numbers of cases for each country.</p></li>
<li><p>Compare some of the age ranges.</p></li>
</ul>
<p>Hard:</p>
<ul class="incremental">
<li><p>Plot cases as a function of sex, age, country, year.</p></li>
<li><p>Model cases as a function of sex, age, country, year.</p></li>
</ul>
</div>
<div class="slide section level2">

<p><img src="tb-long.png" /></p>
<p>Easy:</p>
<ul class="incremental">
<li><p>Plot cases as a function of sex, age, country, year.</p></li>
<li><p>Model cases as a function of sex, age, country, year.</p></li>
</ul>
<p>Hard:</p>
<ul class="incremental">
<li><p>Compute differences between number of cases in different
categories (e.g. differences in cases between males and females holding
all the other categories constant).</p></li>
<li><p>See overall number of cases (not as compact as the other
way).</p></li>
</ul>
</div>
<div id="general-rules-of-thumb" class="slide section level2">
<h1>General rules of thumb</h1>
<ul class="incremental">
<li><p>Columns are all special (accessed by name) and rows are not
special (accessed programmatically).</p></li>
<li><p>Easy to define functional relationships between variables
(e.g. difference between two variables)/hard to define functional
relationships between rows.</p></li>
<li><p>Easy to subset rows/hard to subset columns.</p></li>
<li><p>Easy to aggregate over rows/hard to aggregate over
columns.</p></li>
</ul>
</div>
<div id="reshaping" class="slide section level2">
<h1>Reshaping</h1>
<p>The term for transforming these datasets into each other is called
“reshaping”, and pretty much all reshaping can be done with a
combination of two operations: <code>pivot_longer</code> and
<code>pivot_wider</code>.</p>
<p>These two functions do essentially what their names imply:</p>
<ul class="incremental">
<li><p><code>pivot_longer</code>: Takes a wide dataset and makes it
long</p></li>
<li><p><code>pivot_wider</code>: Takes a long dataset and makes it
wide.</p></li>
</ul>
<p>You usually <code>pivot_longer</code> first to get the data into a
tidy, long form, and then <code>pivot_wider</code> if you need a
different layout for analysis or presentation.</p>
</div>
<div id="pivoting-longer" class="slide section level2">
<h1>Pivoting longer</h1>
<p>The <code>pivot_longer</code> function takes data from wide form to
long form.</p>
<p>Syntax: <code>pivot_longer(data, cols)</code> or (usually)
<code>data |&gt; pivot_longer(cols)</code></p>
<ul class="incremental">
<li><code>data</code> should be a data frame</li>
<li><code>cols</code> the columns to pivot into longer form. The values
corresponding to these columns will all be put into one column in the
output dataset. Can be a character vector or something more complicated
that we will describe later.</li>
</ul>
<p>What does the output look like?</p>
<ul class="incremental">
<li>All the columns not listed in <code>cols</code> remain as identifier
variables.</li>
<li>One new column (called <code>name</code> by default) stores the
former column names (the variable measured).</li>
<li>Another new column (called <code>value</code> by default) stores the
corresponding measurement values.</li>
</ul>
</div>
<div id="pivoting-longer-examples" class="slide section level2">
<h1>Pivoting longer examples</h1>
<p>Let’s see an example. (Actually a very interesting study, can read <a
href="https://www.researchgate.net/publication/226555631_Frying_Performance_of_No-trans_Low-Linolenic_Acid_Soybean_Oils">here</a>.)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">head</span>(french_fries)</span></code></pre></div>
<pre><code>##    time treatment subject rep potato buttery grassy rancid painty
## 61    1         1       3   1    2.9     0.0    0.0    0.0    5.5
## 25    1         1       3   2   14.0     0.0    0.0    1.1    0.0
## 62    1         1      10   1   11.0     6.4    0.0    0.0    0.0
## 26    1         1      10   2    9.9     5.9    2.9    2.2    0.0
## 63    1         1      15   1    1.2     0.1    0.0    1.1    5.1
## 27    1         1      15   2    8.8     3.0    3.6    1.5    2.3</code></pre>
</div>
<div class="slide section level2">

<p>We want to melt this data frame so that the “identification
variables” are time, treatment, subject, rep and the “measurement
variables” are the remainder: potato, buttery, grassy, rancid,
painty.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tidyr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:reshape2&#39;:
## 
##     smiths</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>french_fries_long <span class="ot">&lt;-</span> french_fries <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;potato&quot;</span>, <span class="st">&quot;buttery&quot;</span>, <span class="st">&quot;grassy&quot;</span>, <span class="st">&quot;rancid&quot;</span>, <span class="st">&quot;painty&quot;</span>))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="fu">head</span>(french_fries_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   time  treatment subject   rep name    value
##   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 1     1         3           1 potato    2.9
## 2 1     1         3           1 buttery   0  
## 3 1     1         3           1 grassy    0  
## 4 1     1         3           1 rancid    0  
## 5 1     1         3           1 painty    5.5
## 6 1     1         3           2 potato   14</code></pre>
<p>You can also specify columns using the column numbers (not
recommended) or same syntax that <a
href="https://dplyr.tidyverse.org/reference/select.html"><code>select</code>
uses</a> (much more useful). The following are all equivalent:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>french_fries <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,480 × 6
##    time  treatment subject   rep name    value
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 1     1         3           1 potato    2.9
##  2 1     1         3           1 buttery   0  
##  3 1     1         3           1 grassy    0  
##  4 1     1         3           1 rancid    0  
##  5 1     1         3           1 painty    5.5
##  6 1     1         3           2 potato   14  
##  7 1     1         3           2 buttery   0  
##  8 1     1         3           2 grassy    0  
##  9 1     1         3           2 rancid    1.1
## 10 1     1         3           2 painty    0  
## # ℹ 3,470 more rows</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>french_fries <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(potato, buttery, grassy, rancid, painty))</span></code></pre></div>
<pre><code>## # A tibble: 3,480 × 6
##    time  treatment subject   rep name    value
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 1     1         3           1 potato    2.9
##  2 1     1         3           1 buttery   0  
##  3 1     1         3           1 grassy    0  
##  4 1     1         3           1 rancid    0  
##  5 1     1         3           1 painty    5.5
##  6 1     1         3           2 potato   14  
##  7 1     1         3           2 buttery   0  
##  8 1     1         3           2 grassy    0  
##  9 1     1         3           2 rancid    1.1
## 10 1     1         3           2 painty    0  
## # ℹ 3,470 more rows</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>french_fries <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> potato<span class="sc">:</span>painty)</span></code></pre></div>
<pre><code>## # A tibble: 3,480 × 6
##    time  treatment subject   rep name    value
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 1     1         3           1 potato    2.9
##  2 1     1         3           1 buttery   0  
##  3 1     1         3           1 grassy    0  
##  4 1     1         3           1 rancid    0  
##  5 1     1         3           1 painty    5.5
##  6 1     1         3           2 potato   14  
##  7 1     1         3           2 buttery   0  
##  8 1     1         3           2 grassy    0  
##  9 1     1         3           2 rancid    1.1
## 10 1     1         3           2 painty    0  
## # ℹ 3,470 more rows</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>french_fries <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(time, treatment, subject, rep))</span></code></pre></div>
<pre><code>## # A tibble: 3,480 × 6
##    time  treatment subject   rep name    value
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 1     1         3           1 potato    2.9
##  2 1     1         3           1 buttery   0  
##  3 1     1         3           1 grassy    0  
##  4 1     1         3           1 rancid    0  
##  5 1     1         3           1 painty    5.5
##  6 1     1         3           2 potato   14  
##  7 1     1         3           2 buttery   0  
##  8 1     1         3           2 grassy    0  
##  9 1     1         3           2 rancid    1.1
## 10 1     1         3           2 painty    0  
## # ℹ 3,470 more rows</code></pre>
</div>
<div class="slide section level2">

<p>You can make the output slightly nicer by specifying variable names
and value names with <code>names_to</code> and
<code>values_to</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>french_fries <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> potato<span class="sc">:</span>painty,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;flavor&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;flavor_intensity&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,480 × 6
##    time  treatment subject   rep flavor  flavor_intensity
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
##  1 1     1         3           1 potato               2.9
##  2 1     1         3           1 buttery              0  
##  3 1     1         3           1 grassy               0  
##  4 1     1         3           1 rancid               0  
##  5 1     1         3           1 painty               5.5
##  6 1     1         3           2 potato              14  
##  7 1     1         3           2 buttery              0  
##  8 1     1         3           2 grassy               0  
##  9 1     1         3           2 rancid               1.1
## 10 1     1         3           2 painty               0  
## # ℹ 3,470 more rows</code></pre>
</div>
<div id="pivoting-wider" class="slide section level2">
<h1>Pivoting wider</h1>
<p>Syntax:
<code>pivot_wider(data, id_cols, names_from, values_from, values_fn)</code></p>
<p>or, usually,</p>
<p><code>data |&gt; pivot_wider(id_cols, names_from, values_from, values_fn)</code></p>
<ul class="incremental">
<li><code>data</code> should be a data frame.</li>
<li><code>id_cols</code> specifies the variables you want to use to
define what the rows of the wide data frame should be.</li>
<li><code>names_from</code> specifies the variables you want to use to
define what the columns of the wide data frame sholud be.</li>
<li><code>values_from</code> specifies what the elements of the wide
data frame should be.</li>
<li><code>values_fn</code>: only used in some cases, discussed
later.</li>
</ul>
</div>
<div class="slide section level2">

<p>Example</p>
<div class="incremental">
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>french_fries_long <span class="ot">=</span> french_fries <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> potato<span class="sc">:</span>painty,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;flavor&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;flavor_intensity&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   time  treatment subject   rep flavor  flavor_intensity
##   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 1     1         3           1 potato               2.9
## 2 1     1         3           1 buttery              0  
## 3 1     1         3           1 grassy               0  
## 4 1     1         3           1 rancid               0  
## 5 1     1         3           1 painty               5.5
## 6 1     1         3           2 potato              14</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(subject, rep, flavor),</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>                <span class="at">names_from =</span> <span class="fu">c</span>(time, treatment),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 33
##   subject   rep flavor  `1_1` `1_2` `1_3` `2_1` `2_2` `2_3` `3_1` `3_2` `3_3`
##   &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 3           1 potato    2.9  13.9  14.1   9    14.1   6.5  11.8   4     7.3
## 2 3           1 buttery   0     0     0     0.3   0.9   0.6   0.2   0.1   0.2
## 3 3           1 grassy    0     0     0     0.1   0.3   0.7   0     0     0  
## 4 3           1 rancid    0     3.9   1.1   5.8   2.1   0.1   6     9.2   7.1
## 5 3           1 painty    5.5   0     0     0.3   0     1.4   0     0     0  
## 6 3           2 potato   14    13.4   9.5   5.5   3.3  13.8   7.8   9.9   7.3
## # ℹ 21 more variables: `4_1` &lt;dbl&gt;, `4_2` &lt;dbl&gt;, `4_3` &lt;dbl&gt;, `5_1` &lt;dbl&gt;,
## #   `5_2` &lt;dbl&gt;, `5_3` &lt;dbl&gt;, `6_1` &lt;dbl&gt;, `6_2` &lt;dbl&gt;, `6_3` &lt;dbl&gt;,
## #   `7_1` &lt;dbl&gt;, `7_2` &lt;dbl&gt;, `7_3` &lt;dbl&gt;, `8_1` &lt;dbl&gt;, `8_2` &lt;dbl&gt;,
## #   `8_3` &lt;dbl&gt;, `9_1` &lt;dbl&gt;, `9_2` &lt;dbl&gt;, `9_3` &lt;dbl&gt;, `10_1` &lt;dbl&gt;,
## #   `10_2` &lt;dbl&gt;, `10_3` &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span> <span class="fu">subset</span>(time <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> subject <span class="sc">==</span> <span class="st">&quot;3&quot;</span> <span class="sc">&amp;</span> rep <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> flavor <span class="sc">==</span> <span class="st">&quot;potato&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   time  treatment subject   rep flavor flavor_intensity
##   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
## 1 1     1         3           1 potato              2.9
## 2 1     2         3           1 potato             13.9
## 3 1     3         3           1 potato             14.1</code></pre>
</div>
</div>
<div class="slide section level2">

<p>If you don’t specify <code>id_cols</code>, <code>pivot_wider</code>
assumes that everything that is not specified in <code>names_from</code>
and <code>values_from</code> should be used as <code>id_cols</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(subject, rep, flavor),</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>                <span class="at">names_from =</span> <span class="fu">c</span>(time, treatment),</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 33
##   subject   rep flavor  `1_1` `1_2` `1_3` `2_1` `2_2` `2_3` `3_1` `3_2` `3_3`
##   &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 3           1 potato    2.9  13.9  14.1   9    14.1   6.5  11.8   4     7.3
## 2 3           1 buttery   0     0     0     0.3   0.9   0.6   0.2   0.1   0.2
## 3 3           1 grassy    0     0     0     0.1   0.3   0.7   0     0     0  
## 4 3           1 rancid    0     3.9   1.1   5.8   2.1   0.1   6     9.2   7.1
## 5 3           1 painty    5.5   0     0     0.3   0     1.4   0     0     0  
## 6 3           2 potato   14    13.4   9.5   5.5   3.3  13.8   7.8   9.9   7.3
## # ℹ 21 more variables: `4_1` &lt;dbl&gt;, `4_2` &lt;dbl&gt;, `4_3` &lt;dbl&gt;, `5_1` &lt;dbl&gt;,
## #   `5_2` &lt;dbl&gt;, `5_3` &lt;dbl&gt;, `6_1` &lt;dbl&gt;, `6_2` &lt;dbl&gt;, `6_3` &lt;dbl&gt;,
## #   `7_1` &lt;dbl&gt;, `7_2` &lt;dbl&gt;, `7_3` &lt;dbl&gt;, `8_1` &lt;dbl&gt;, `8_2` &lt;dbl&gt;,
## #   `8_3` &lt;dbl&gt;, `9_1` &lt;dbl&gt;, `9_2` &lt;dbl&gt;, `9_3` &lt;dbl&gt;, `10_1` &lt;dbl&gt;,
## #   `10_2` &lt;dbl&gt;, `10_3` &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(time, treatment),</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 33
##   subject   rep flavor  `1_1` `1_2` `1_3` `2_1` `2_2` `2_3` `3_1` `3_2` `3_3`
##   &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 3           1 potato    2.9  13.9  14.1   9    14.1   6.5  11.8   4     7.3
## 2 3           1 buttery   0     0     0     0.3   0.9   0.6   0.2   0.1   0.2
## 3 3           1 grassy    0     0     0     0.1   0.3   0.7   0     0     0  
## 4 3           1 rancid    0     3.9   1.1   5.8   2.1   0.1   6     9.2   7.1
## 5 3           1 painty    5.5   0     0     0.3   0     1.4   0     0     0  
## 6 3           2 potato   14    13.4   9.5   5.5   3.3  13.8   7.8   9.9   7.3
## # ℹ 21 more variables: `4_1` &lt;dbl&gt;, `4_2` &lt;dbl&gt;, `4_3` &lt;dbl&gt;, `5_1` &lt;dbl&gt;,
## #   `5_2` &lt;dbl&gt;, `5_3` &lt;dbl&gt;, `6_1` &lt;dbl&gt;, `6_2` &lt;dbl&gt;, `6_3` &lt;dbl&gt;,
## #   `7_1` &lt;dbl&gt;, `7_2` &lt;dbl&gt;, `7_3` &lt;dbl&gt;, `8_1` &lt;dbl&gt;, `8_2` &lt;dbl&gt;,
## #   `8_3` &lt;dbl&gt;, `9_1` &lt;dbl&gt;, `9_2` &lt;dbl&gt;, `9_3` &lt;dbl&gt;, `10_1` &lt;dbl&gt;,
## #   `10_2` &lt;dbl&gt;, `10_3` &lt;dbl&gt;</code></pre>
</div>
<div id="aggregation" class="slide section level2">
<h1>Aggregation</h1>
<p>When you pivot wider, you don’t necessarily use all of the
variables.</p>
<p>This means that each element of the cast table will correspond to
more than one measurement, and so they need to be aggregated in some
way.</p>
<div class="incremental">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">head</span>(french_fries_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   time  treatment subject   rep flavor  flavor_intensity
##   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 1     1         3           1 potato               2.9
## 2 1     1         3           1 buttery              0  
## 3 1     1         3           1 grassy               0  
## 4 1     1         3           1 rancid               0  
## 5 1     1         3           1 painty               5.5
## 6 1     1         3           2 potato              14</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> time,</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>                <span class="at">names_from =</span> flavor,</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity)</span></code></pre></div>
<pre><code>## Warning: Values from `flavor_intensity` are not uniquely identified; output will contain list-cols.
## • Use `values_fn = list` to suppress this warning.
## • Use `values_fn = {summary_fun}` to summarise duplicates.
## • Use the following dplyr code to identify duplicates.
##   {data} |&gt;
##   dplyr::summarise(n = dplyr::n(), .by = c(time, flavor)) |&gt;
##   dplyr::filter(n &gt; 1L)</code></pre>
<pre><code>## # A tibble: 10 × 6
##    time  potato     buttery    grassy     rancid     painty    
##    &lt;fct&gt; &lt;list&gt;     &lt;list&gt;     &lt;list&gt;     &lt;list&gt;     &lt;list&gt;    
##  1 1     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  2 2     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  3 3     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  4 4     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  5 5     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  6 6     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  7 7     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  8 8     &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt; &lt;dbl [72]&gt;
##  9 9     &lt;dbl [60]&gt; &lt;dbl [60]&gt; &lt;dbl [60]&gt; &lt;dbl [60]&gt; &lt;dbl [60]&gt;
## 10 10    &lt;dbl [60]&gt; &lt;dbl [60]&gt; &lt;dbl [60]&gt; &lt;dbl [60]&gt; &lt;dbl [60]&gt;</code></pre>
</div>
</div>
<div class="slide section level2">

<p>You can use the <code>values_fn</code> argument to
<code>pivot_wider</code> to define how to aggregate values.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> time,</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>                <span class="at">names_from =</span> flavor,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>                <span class="at">values_fn =</span> mean)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##    time  potato buttery grassy rancid painty
##    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 1       8.56    2.24  0.942   2.36   1.65
##  2 2       8.06    2.72  1.18    2.85   1.44
##  3 3       7.80    2.10  0.75    3.72   1.31
##  4 4       7.71    1.80  0.742   3.60   1.37
##  5 5      NA      NA    NA      NA     NA   
##  6 6       6.67    1.75  0.674   4.08   2.34
##  7 7       6.17   NA     0.421   3.89   2.68
##  8 8       5.43   NA     0.381   4.27  NA   
##  9 9       5.67    1.59  0.277   4.67   3.87
## 10 10      5.70    1.76  0.557   6.07   5.29</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> flavor,</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>                <span class="at">id_cols =</span> time,</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity,</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>                <span class="at">values_fn =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##    time  potato buttery grassy rancid painty
##    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 1       8.56    2.24  0.942   2.36   1.65
##  2 2       8.06    2.72  1.18    2.85   1.44
##  3 3       7.80    2.10  0.75    3.72   1.31
##  4 4       7.71    1.80  0.742   3.60   1.37
##  5 5      NA      NA    NA      NA     NA   
##  6 6       6.67    1.75  0.674   4.08   2.34
##  7 7       6.17   NA     0.421   3.89   2.68
##  8 8       5.43   NA     0.381   4.27  NA   
##  9 9       5.67    1.59  0.277   4.67   3.87
## 10 10      5.70    1.76  0.557   6.07   5.29</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> flavor,</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>                <span class="at">id_cols =</span> time,</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity,</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>                <span class="at">values_fn =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##    time  potato buttery grassy rancid painty
##    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 1       8.56    2.24  0.942   2.36   1.65
##  2 2       8.06    2.72  1.18    2.85   1.44
##  3 3       7.80    2.10  0.75    3.72   1.31
##  4 4       7.71    1.80  0.742   3.60   1.37
##  5 5       7.33    1.64  0.635   3.53   2.02
##  6 6       6.67    1.75  0.674   4.08   2.34
##  7 7       6.17    1.37  0.421   3.89   2.68
##  8 8       5.43    1.18  0.381   4.27   3.94
##  9 9       5.67    1.59  0.277   4.67   3.87
## 10 10      5.70    1.76  0.557   6.07   5.29</code></pre>
<p>The <code>tidyverse</code> functions also have shortcut notation for
defining anonymous functions. See <a
href="https://adv-r.hadley.nz/functionals.html?q=lambda%20function#purrr-shortcuts">here</a>
for details. It works best for functions that have one or two arguments,
which are referred to as <code>.x</code> (first/only argument) and
<code>.y</code> (second argument in a two-argument function).</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="do">## &quot;shortcut&quot; version</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>french_fries_long <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> flavor,</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>                <span class="at">id_cols =</span> time,</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>                <span class="at">values_from =</span> flavor_intensity,</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>                <span class="at">values_fn =</span> <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##    time  potato buttery grassy rancid painty
##    &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 1       8.56    2.24  0.942   2.36   1.65
##  2 2       8.06    2.72  1.18    2.85   1.44
##  3 3       7.80    2.10  0.75    3.72   1.31
##  4 4       7.71    1.80  0.742   3.60   1.37
##  5 5       7.33    1.64  0.635   3.53   2.02
##  6 6       6.67    1.75  0.674   4.08   2.34
##  7 7       6.17    1.37  0.421   3.89   2.68
##  8 8       5.43    1.18  0.381   4.27   3.94
##  9 9       5.67    1.59  0.277   4.67   3.87
## 10 10      5.70    1.76  0.557   6.07   5.29</code></pre>
</div>
<div id="merging" class="slide section level2">
<h1>Merging</h1>
<p>Final topic: What if you have data from two different places and you
need to put them together?</p>
<p>Base R syntax: <code>merge(x, y, by.x, by.y)</code></p>
<ul class="incremental">
<li><p><code>x</code> and <code>y</code> are the two datasets you want
to merge.</p></li>
<li><p><code>by.x</code> is the column of <code>x</code> to merge
on.</p></li>
<li><p><code>by.y</code> is the column of <code>y</code> to merge
on.</p></li>
</ul>
<p>dpylr syntax:
<code>*_join(x, y, by = c("x_col" = "y_col"))</code></p>
<ul class="incremental">
<li><p><code>*_join</code> can be any of <code>left_join</code>,
<code>right_join</code>, <code>inner_join</code>, <code>full_join</code>
for different types of merges.</p></li>
<li><p><code>by</code> argument is a character vector specifying the
columns to join on.</p></li>
<li><p>Defaults to matching all columns with the same name.</p></li>
</ul>
</div>
<div class="slide section level2">

<p>Example:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>    <span class="at">city=</span><span class="fu">c</span>(<span class="st">&#39;New York&#39;</span>,<span class="st">&#39;Boston&#39;</span>,<span class="st">&#39;Juneau&#39;</span>,</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>           <span class="st">&#39;Anchorage&#39;</span>,<span class="st">&#39;San Diego&#39;</span>,</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>           <span class="st">&#39;Philadelphia&#39;</span>,<span class="st">&#39;Los Angeles&#39;</span>,</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>           <span class="st">&#39;Fairbanks&#39;</span>,<span class="st">&#39;Ann Arbor&#39;</span>,<span class="st">&#39;Seattle&#39;</span>),</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>    <span class="at">state.abb=</span><span class="fu">c</span>(<span class="st">&#39;NY&#39;</span>,<span class="st">&#39;MA&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;CA&#39;</span>,</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>                <span class="st">&#39;PA&#39;</span>,<span class="st">&#39;CA&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;MI&#39;</span>,<span class="st">&#39;WA&#39;</span>))</span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(state.name, state.abb)</span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>cities</span></code></pre></div>
<pre><code>##            city state.abb
## 1      New York        NY
## 2        Boston        MA
## 3        Juneau        AK
## 4     Anchorage        AK
## 5     San Diego        CA
## 6  Philadelphia        PA
## 7   Los Angeles        CA
## 8     Fairbanks        AK
## 9     Ann Arbor        MI
## 10      Seattle        WA</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">head</span>(states)</span></code></pre></div>
<pre><code>##   state.name state.abb
## 1    Alabama        AL
## 2     Alaska        AK
## 3    Arizona        AZ
## 4   Arkansas        AR
## 5 California        CA
## 6   Colorado        CO</code></pre>
<p>We want to add the state name to the cities data frame, and we can
use merge.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="do">## base R</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="fu">merge</span>(states, cities, <span class="at">by.x =</span> <span class="st">&quot;state.abb&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;state.abb&quot;</span>)</span></code></pre></div>
<pre><code>##    state.abb    state.name         city
## 1         AK        Alaska       Juneau
## 2         AK        Alaska    Anchorage
## 3         AK        Alaska    Fairbanks
## 4         CA    California    San Diego
## 5         CA    California  Los Angeles
## 6         MA Massachusetts       Boston
## 7         MI      Michigan    Ann Arbor
## 8         NY      New York     New York
## 9         PA  Pennsylvania Philadelphia
## 10        WA    Washington      Seattle</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="do">## dplyr</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="fu">inner_join</span>(states, cities, <span class="at">by =</span> <span class="st">&quot;state.abb&quot;</span>)</span></code></pre></div>
<pre><code>##       state.name state.abb         city
## 1         Alaska        AK       Juneau
## 2         Alaska        AK    Anchorage
## 3         Alaska        AK    Fairbanks
## 4     California        CA    San Diego
## 5     California        CA  Los Angeles
## 6  Massachusetts        MA       Boston
## 7       Michigan        MI    Ann Arbor
## 8       New York        NY     New York
## 9   Pennsylvania        PA Philadelphia
## 10    Washington        WA      Seattle</code></pre>
</div>
<div class="slide section level2">

<p>Notice in the last example that there was some ambiguity in how the
merge took place because the two datasets have different sets of values
for <code>state.abb</code>.</p>
<ul class="incremental">
<li><p>In base R, the default is an inner join (you get one row for each
value of the merging variable that was seen in both <code>x</code> and
<code>y</code>)</p></li>
<li><p>Modify with <code>all</code>, <code>all.x</code>,
<code>all.y</code>:</p></li>
<li><p><code>all = TRUE</code> is a full outer join (you get one row for
values of the merging variable that were seen in either <code>x</code>
or <code>y</code>)</p></li>
<li><p><code>all.x = TRUE</code> is a left join (you get one row for
each value of the merging variable that was seen in
<code>x</code>)</p></li>
<li><p><code>all.y = TRUE</code> is a right join (you get one row for
each value of the merging variable that was seen in
<code>y</code>)</p></li>
<li><p>In dplyr, you use <code>inner_join</code>,
<code>outer_join</code>, <code>left_join</code>,
<code>right_join</code></p></li>
</ul>
</div>
<div class="slide section level2">

<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">merge</span>(states, cities, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    state.abb     state.name         city
## 1         AK         Alaska       Juneau
## 2         AK         Alaska    Anchorage
## 3         AK         Alaska    Fairbanks
## 4         AL        Alabama         &lt;NA&gt;
## 5         AR       Arkansas         &lt;NA&gt;
## 6         AZ        Arizona         &lt;NA&gt;
## 7         CA     California    San Diego
## 8         CA     California  Los Angeles
## 9         CO       Colorado         &lt;NA&gt;
## 10        CT    Connecticut         &lt;NA&gt;
## 11        DE       Delaware         &lt;NA&gt;
## 12        FL        Florida         &lt;NA&gt;
## 13        GA        Georgia         &lt;NA&gt;
## 14        HI         Hawaii         &lt;NA&gt;
## 15        IA           Iowa         &lt;NA&gt;
## 16        ID          Idaho         &lt;NA&gt;
## 17        IL       Illinois         &lt;NA&gt;
## 18        IN        Indiana         &lt;NA&gt;
## 19        KS         Kansas         &lt;NA&gt;
## 20        KY       Kentucky         &lt;NA&gt;
## 21        LA      Louisiana         &lt;NA&gt;
## 22        MA  Massachusetts       Boston
## 23        MD       Maryland         &lt;NA&gt;
## 24        ME          Maine         &lt;NA&gt;
## 25        MI       Michigan    Ann Arbor
## 26        MN      Minnesota         &lt;NA&gt;
## 27        MO       Missouri         &lt;NA&gt;
## 28        MS    Mississippi         &lt;NA&gt;
## 29        MT        Montana         &lt;NA&gt;
## 30        NC North Carolina         &lt;NA&gt;
## 31        ND   North Dakota         &lt;NA&gt;
## 32        NE       Nebraska         &lt;NA&gt;
## 33        NH  New Hampshire         &lt;NA&gt;
## 34        NJ     New Jersey         &lt;NA&gt;
## 35        NM     New Mexico         &lt;NA&gt;
## 36        NV         Nevada         &lt;NA&gt;
## 37        NY       New York     New York
## 38        OH           Ohio         &lt;NA&gt;
## 39        OK       Oklahoma         &lt;NA&gt;
## 40        OR         Oregon         &lt;NA&gt;
## 41        PA   Pennsylvania Philadelphia
## 42        RI   Rhode Island         &lt;NA&gt;
## 43        SC South Carolina         &lt;NA&gt;
## 44        SD   South Dakota         &lt;NA&gt;
## 45        TN      Tennessee         &lt;NA&gt;
## 46        TX          Texas         &lt;NA&gt;
## 47        UT           Utah         &lt;NA&gt;
## 48        VA       Virginia         &lt;NA&gt;
## 49        VT        Vermont         &lt;NA&gt;
## 50        WA     Washington      Seattle
## 51        WI      Wisconsin         &lt;NA&gt;
## 52        WV  West Virginia         &lt;NA&gt;
## 53        WY        Wyoming         &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">left_join</span>(states, cities, <span class="at">by =</span> <span class="st">&quot;state.abb&quot;</span>)</span></code></pre></div>
<pre><code>##        state.name state.abb         city
## 1         Alabama        AL         &lt;NA&gt;
## 2          Alaska        AK       Juneau
## 3          Alaska        AK    Anchorage
## 4          Alaska        AK    Fairbanks
## 5         Arizona        AZ         &lt;NA&gt;
## 6        Arkansas        AR         &lt;NA&gt;
## 7      California        CA    San Diego
## 8      California        CA  Los Angeles
## 9        Colorado        CO         &lt;NA&gt;
## 10    Connecticut        CT         &lt;NA&gt;
## 11       Delaware        DE         &lt;NA&gt;
## 12        Florida        FL         &lt;NA&gt;
## 13        Georgia        GA         &lt;NA&gt;
## 14         Hawaii        HI         &lt;NA&gt;
## 15          Idaho        ID         &lt;NA&gt;
## 16       Illinois        IL         &lt;NA&gt;
## 17        Indiana        IN         &lt;NA&gt;
## 18           Iowa        IA         &lt;NA&gt;
## 19         Kansas        KS         &lt;NA&gt;
## 20       Kentucky        KY         &lt;NA&gt;
## 21      Louisiana        LA         &lt;NA&gt;
## 22          Maine        ME         &lt;NA&gt;
## 23       Maryland        MD         &lt;NA&gt;
## 24  Massachusetts        MA       Boston
## 25       Michigan        MI    Ann Arbor
## 26      Minnesota        MN         &lt;NA&gt;
## 27    Mississippi        MS         &lt;NA&gt;
## 28       Missouri        MO         &lt;NA&gt;
## 29        Montana        MT         &lt;NA&gt;
## 30       Nebraska        NE         &lt;NA&gt;
## 31         Nevada        NV         &lt;NA&gt;
## 32  New Hampshire        NH         &lt;NA&gt;
## 33     New Jersey        NJ         &lt;NA&gt;
## 34     New Mexico        NM         &lt;NA&gt;
## 35       New York        NY     New York
## 36 North Carolina        NC         &lt;NA&gt;
## 37   North Dakota        ND         &lt;NA&gt;
## 38           Ohio        OH         &lt;NA&gt;
## 39       Oklahoma        OK         &lt;NA&gt;
## 40         Oregon        OR         &lt;NA&gt;
## 41   Pennsylvania        PA Philadelphia
## 42   Rhode Island        RI         &lt;NA&gt;
## 43 South Carolina        SC         &lt;NA&gt;
## 44   South Dakota        SD         &lt;NA&gt;
## 45      Tennessee        TN         &lt;NA&gt;
## 46          Texas        TX         &lt;NA&gt;
## 47           Utah        UT         &lt;NA&gt;
## 48        Vermont        VT         &lt;NA&gt;
## 49       Virginia        VA         &lt;NA&gt;
## 50     Washington        WA      Seattle
## 51  West Virginia        WV         &lt;NA&gt;
## 52      Wisconsin        WI         &lt;NA&gt;
## 53        Wyoming        WY         &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">merge</span>(states, cities, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    state.abb    state.name         city
## 1         AK        Alaska       Juneau
## 2         AK        Alaska    Anchorage
## 3         AK        Alaska    Fairbanks
## 4         CA    California    San Diego
## 5         CA    California  Los Angeles
## 6         MA Massachusetts       Boston
## 7         MI      Michigan    Ann Arbor
## 8         NY      New York     New York
## 9         PA  Pennsylvania Philadelphia
## 10        WA    Washington      Seattle</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="fu">right_join</span>(states, cities, <span class="at">by =</span> <span class="st">&quot;state.abb&quot;</span>)</span></code></pre></div>
<pre><code>##       state.name state.abb         city
## 1         Alaska        AK       Juneau
## 2         Alaska        AK    Anchorage
## 3         Alaska        AK    Fairbanks
## 4     California        CA    San Diego
## 5     California        CA  Los Angeles
## 6  Massachusetts        MA       Boston
## 7       Michigan        MI    Ann Arbor
## 8       New York        NY     New York
## 9   Pennsylvania        PA Philadelphia
## 10    Washington        WA      Seattle</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="fu">merge</span>(states, cities, <span class="at">all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    state.abb     state.name         city
## 1         AK         Alaska       Juneau
## 2         AK         Alaska    Anchorage
## 3         AK         Alaska    Fairbanks
## 4         AL        Alabama         &lt;NA&gt;
## 5         AR       Arkansas         &lt;NA&gt;
## 6         AZ        Arizona         &lt;NA&gt;
## 7         CA     California    San Diego
## 8         CA     California  Los Angeles
## 9         CO       Colorado         &lt;NA&gt;
## 10        CT    Connecticut         &lt;NA&gt;
## 11        DE       Delaware         &lt;NA&gt;
## 12        FL        Florida         &lt;NA&gt;
## 13        GA        Georgia         &lt;NA&gt;
## 14        HI         Hawaii         &lt;NA&gt;
## 15        IA           Iowa         &lt;NA&gt;
## 16        ID          Idaho         &lt;NA&gt;
## 17        IL       Illinois         &lt;NA&gt;
## 18        IN        Indiana         &lt;NA&gt;
## 19        KS         Kansas         &lt;NA&gt;
## 20        KY       Kentucky         &lt;NA&gt;
## 21        LA      Louisiana         &lt;NA&gt;
## 22        MA  Massachusetts       Boston
## 23        MD       Maryland         &lt;NA&gt;
## 24        ME          Maine         &lt;NA&gt;
## 25        MI       Michigan    Ann Arbor
## 26        MN      Minnesota         &lt;NA&gt;
## 27        MO       Missouri         &lt;NA&gt;
## 28        MS    Mississippi         &lt;NA&gt;
## 29        MT        Montana         &lt;NA&gt;
## 30        NC North Carolina         &lt;NA&gt;
## 31        ND   North Dakota         &lt;NA&gt;
## 32        NE       Nebraska         &lt;NA&gt;
## 33        NH  New Hampshire         &lt;NA&gt;
## 34        NJ     New Jersey         &lt;NA&gt;
## 35        NM     New Mexico         &lt;NA&gt;
## 36        NV         Nevada         &lt;NA&gt;
## 37        NY       New York     New York
## 38        OH           Ohio         &lt;NA&gt;
## 39        OK       Oklahoma         &lt;NA&gt;
## 40        OR         Oregon         &lt;NA&gt;
## 41        PA   Pennsylvania Philadelphia
## 42        RI   Rhode Island         &lt;NA&gt;
## 43        SC South Carolina         &lt;NA&gt;
## 44        SD   South Dakota         &lt;NA&gt;
## 45        TN      Tennessee         &lt;NA&gt;
## 46        TX          Texas         &lt;NA&gt;
## 47        UT           Utah         &lt;NA&gt;
## 48        VA       Virginia         &lt;NA&gt;
## 49        VT        Vermont         &lt;NA&gt;
## 50        WA     Washington      Seattle
## 51        WI      Wisconsin         &lt;NA&gt;
## 52        WV  West Virginia         &lt;NA&gt;
## 53        WY        Wyoming         &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="fu">full_join</span>(states, cities, <span class="at">by =</span> <span class="st">&quot;state.abb&quot;</span>)</span></code></pre></div>
<pre><code>##        state.name state.abb         city
## 1         Alabama        AL         &lt;NA&gt;
## 2          Alaska        AK       Juneau
## 3          Alaska        AK    Anchorage
## 4          Alaska        AK    Fairbanks
## 5         Arizona        AZ         &lt;NA&gt;
## 6        Arkansas        AR         &lt;NA&gt;
## 7      California        CA    San Diego
## 8      California        CA  Los Angeles
## 9        Colorado        CO         &lt;NA&gt;
## 10    Connecticut        CT         &lt;NA&gt;
## 11       Delaware        DE         &lt;NA&gt;
## 12        Florida        FL         &lt;NA&gt;
## 13        Georgia        GA         &lt;NA&gt;
## 14         Hawaii        HI         &lt;NA&gt;
## 15          Idaho        ID         &lt;NA&gt;
## 16       Illinois        IL         &lt;NA&gt;
## 17        Indiana        IN         &lt;NA&gt;
## 18           Iowa        IA         &lt;NA&gt;
## 19         Kansas        KS         &lt;NA&gt;
## 20       Kentucky        KY         &lt;NA&gt;
## 21      Louisiana        LA         &lt;NA&gt;
## 22          Maine        ME         &lt;NA&gt;
## 23       Maryland        MD         &lt;NA&gt;
## 24  Massachusetts        MA       Boston
## 25       Michigan        MI    Ann Arbor
## 26      Minnesota        MN         &lt;NA&gt;
## 27    Mississippi        MS         &lt;NA&gt;
## 28       Missouri        MO         &lt;NA&gt;
## 29        Montana        MT         &lt;NA&gt;
## 30       Nebraska        NE         &lt;NA&gt;
## 31         Nevada        NV         &lt;NA&gt;
## 32  New Hampshire        NH         &lt;NA&gt;
## 33     New Jersey        NJ         &lt;NA&gt;
## 34     New Mexico        NM         &lt;NA&gt;
## 35       New York        NY     New York
## 36 North Carolina        NC         &lt;NA&gt;
## 37   North Dakota        ND         &lt;NA&gt;
## 38           Ohio        OH         &lt;NA&gt;
## 39       Oklahoma        OK         &lt;NA&gt;
## 40         Oregon        OR         &lt;NA&gt;
## 41   Pennsylvania        PA Philadelphia
## 42   Rhode Island        RI         &lt;NA&gt;
## 43 South Carolina        SC         &lt;NA&gt;
## 44   South Dakota        SD         &lt;NA&gt;
## 45      Tennessee        TN         &lt;NA&gt;
## 46          Texas        TX         &lt;NA&gt;
## 47           Utah        UT         &lt;NA&gt;
## 48        Vermont        VT         &lt;NA&gt;
## 49       Virginia        VA         &lt;NA&gt;
## 50     Washington        WA      Seattle
## 51  West Virginia        WV         &lt;NA&gt;
## 52      Wisconsin        WI         &lt;NA&gt;
## 53        Wyoming        WY         &lt;NA&gt;</code></pre>
</div>
<div class="slide section level2">

<p>Some additional notes:</p>
<ul class="incremental">
<li><p>Default if you don’t specify <code>by.x</code> and
<code>by.y</code> is to use the columns that are common to the
two.</p></li>
<li><p><code>by.x</code>/<code>by.y</code> can have length more than 1,
in which case we match on the entire set of specified
variables.</p></li>
<li><p>Can use <code>by</code> instead of <code>by.x</code> and
<code>by.y</code>, in which case the name of the column to merge on has
to be the same in both <code>x</code> and <code>y</code>.</p></li>
</ul>
</div>
<div class="slide section level2">

<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">&quot;New York&quot;</span>, <span class="st">&quot;Boston&quot;</span>, <span class="st">&quot;Juneau&quot;</span>, <span class="st">&quot;Anchorage&quot;</span>, <span class="st">&quot;San Diego&quot;</span>),</span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>  <span class="at">state.abb =</span> <span class="fu">c</span>(<span class="st">&quot;NY&quot;</span>, <span class="st">&quot;MA&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;CA&quot;</span>),</span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2021</span>, <span class="dv">2020</span>)</span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>)</span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a>  <span class="at">abb =</span> <span class="fu">c</span>(<span class="st">&quot;NY&quot;</span>, <span class="st">&quot;MA&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;CA&quot;</span>),</span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2020</span>, <span class="dv">2020</span>),</span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a>  <span class="at">pop_million =</span> <span class="fu">c</span>(<span class="fl">19.3</span>, <span class="fl">6.9</span>, <span class="fl">0.7</span>, <span class="fl">0.73</span>, <span class="fl">39.5</span>)</span>
<span id="cb65-12"><a href="#cb65-12" tabindex="-1"></a>)</span>
<span id="cb65-13"><a href="#cb65-13" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" tabindex="-1"></a>cities</span></code></pre></div>
<pre><code>##        city state.abb year
## 1  New York        NY 2020
## 2    Boston        MA 2020
## 3    Juneau        AK 2021
## 4 Anchorage        AK 2021
## 5 San Diego        CA 2020</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>population</span></code></pre></div>
<pre><code>##   abb year pop_million
## 1  NY 2020       19.30
## 2  MA 2020        6.90
## 3  AK 2021        0.70
## 4  AK 2020        0.73
## 5  CA 2020       39.50</code></pre>
<p>Notice that <code>cities</code> and <code>population</code> have
different names for the column giving the state abbreviation.</p>
<p>Below we see an example of merging on two columns in base R and in
dplyr when the column names are not the same in the two datasets.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="fu">merge</span>(cities, population, <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">&quot;state.abb&quot;</span>, <span class="st">&quot;year&quot;</span>), <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">&quot;abb&quot;</span>, <span class="st">&quot;year&quot;</span>))</span></code></pre></div>
<pre><code>##   state.abb year      city pop_million
## 1        AK 2021    Juneau         0.7
## 2        AK 2021 Anchorage         0.7
## 3        CA 2020 San Diego        39.5
## 4        MA 2020    Boston         6.9
## 5        NY 2020  New York        19.3</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">inner_join</span>(cities, population, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;state.abb&quot;</span> <span class="ot">=</span> <span class="st">&quot;abb&quot;</span>, <span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;year&quot;</span>))</span></code></pre></div>
<pre><code>##        city state.abb year pop_million
## 1  New York        NY 2020        19.3
## 2    Boston        MA 2020         6.9
## 3    Juneau        AK 2021         0.7
## 4 Anchorage        AK 2021         0.7
## 5 San Diego        CA 2020        39.5</code></pre>
</div>
</body>
</html>
