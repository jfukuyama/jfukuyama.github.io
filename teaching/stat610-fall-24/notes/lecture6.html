<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Stat 610 Lecture 6: More on functions</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Stat 610 Lecture 6: More on functions</h1>
</div>
<div id="writing-and-calling-functions" class="slide section level2">
<h1>Writing and calling functions</h1>
<p>Agenda for today:</p>
<ul class="incremental">
<li>Show some examples of how you might write functions.</li>
</ul>
<blockquote>
<p>It is my purpose to transmit the importance of good taste and style
in programming, [but] the specific elements of style presented serve
only to illustrate what benefits can be derived from “style” in general.
In this respect I feel akin to the teacher of composition at a
conservatory: He does not teach his pupils how to compose a particular
symphony, he must help his pupils to find their own style and must
explain to them what is implied by this. (It has been this analogy that
made me talk about “The Art of Programming.”)</p>
</blockquote>
<p>Don Knuth, quoting Dijkstra in his book “Literate Programming”</p>
</div>
<div id="some-suggestions-for-writing-functions"
class="slide section level2">
<h1>Some suggestions for writing functions</h1>
<ul class="incremental">
<li><p>“The first rule of functions is that they should be small. The
second rule of functions is that <em>they should be smaller than
that</em>.”</p></li>
<li><p>Functions should <em>do one thing</em>. Multiple tasks = multiple
functions.</p></li>
<li><p>Related functions should have consistent interfaces: if they take
the same input, they should have the same arguments in the same order.
If they make the same output, they should give output in the same
way.</p></li>
<li><p>No side effects.</p></li>
<li><p>No <a
href="https://en.wikipedia.org/wiki/Magic_number_(programming)#Unnamed_numerical_constants">magic
numbers</a>.</p></li>
</ul>
<div class="incremental">
<p>But, like <a
href="http://languagelog.ldc.upenn.edu/nll/?p=992">Orwell’s last rule
for effective writing</a>: break any of these rules rather than write
something outright barbarous.</p>
</div>
</div>
<div id="example-the-birthday-problem" class="slide section level2">
<h1>Example: <a
href="https://en.wikipedia.org/wiki/Birthday_problem">The birthday
problem</a></h1>
<p>Suppose:</p>
<ul class="incremental">
<li><p>We have a randomly chosen set of <span
class="math inline">\(n\)</span> people</p></li>
<li><p>Each person has a birthday</p></li>
<li><p>Birthdays are distributed uniformly, so every day of the year is
equally likely to be a given person’s birthday</p></li>
</ul>
<p>Question: What is the probability that at least two people share a
birthday?</p>
<div class="incremental">
<p>Logic says: “At least two people share a birthday” is the same as
“It’s not true that all the birthdays are distinct”.</p>
<p>Probability says:</p>
<ul class="incremental">
<li><p><span class="math inline">\(P(\text{All birthdays are distinct})
= \frac{365}{365} \frac{364}{365} \cdots
\frac{365-(n-1)}{365}\)</span></p></li>
<li><p><span class="math inline">\(P(\text{At least two people share a
birthday}) = 1 - P(\text{All birthdays are distinct}) = \frac{365}{365}
\frac{364}{365} \cdots \frac{365-(n-1)}{365}\)</span></p></li>
</ul>
</div>
</div>
<div class="slide section level2">

<p>We can write a function that computes these probabilities as a
function of the number of people:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>compute_birthday_probability <span class="ot">&lt;-</span> <span class="cf">function</span>(n_people) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    p_all_distinct <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="fu">seq</span>(<span class="dv">365</span><span class="sc">-</span>(n_people<span class="dv">-1</span>), <span class="dv">365</span>)) <span class="sc">/</span> (<span class="dv">365</span><span class="sc">^</span>n_people)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    p_match <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p_all_distinct</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="fu">return</span>(p_match)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">compute_birthday_probability</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">compute_birthday_probability</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.002739726</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">compute_birthday_probability</span>(<span class="dv">22</span>)</span></code></pre></div>
<pre><code>## [1] 0.4756953</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">compute_birthday_probability</span>(<span class="dv">23</span>)</span></code></pre></div>
<pre><code>## [1] 0.5072972</code></pre>
</div>
<div class="slide section level2">

<p>Suppose we don’t know any probability.</p>
<p>We can try simulating to solve the birthday problem.</p>
<p>As we did before, we can simulate birthdays from different numbers of
people and check whether any of them share a birthday.</p>
<p>For just one simulation, we can do:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>n_people <span class="ot">&lt;-</span> <span class="dv">23</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>birthdays <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, <span class="at">size =</span> n_people, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>n_birthdays_per_day <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">365</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>) {</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    n_birthdays_per_day[day] <span class="ot">&lt;-</span> <span class="fu">sum</span>(birthdays <span class="sc">==</span> day)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>}</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">max</span>(n_birthdays_per_day) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;At least two people share a birthday&quot;</span>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;No two people share a birthday&quot;</span>)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;At least two people share a birthday&quot;</code></pre>
</div>
<div class="slide section level2">

<p>If we wanted to do lots of simulations to get an estimate of the
probability of a match, we <em>could</em> use a for loop:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>n_people <span class="ot">&lt;-</span> <span class="dv">23</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>match_vector <span class="ot">&lt;-</span> <span class="fu">character</span>(n_sim)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    birthdays <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, <span class="at">size =</span> n_people, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    n_birthdays_per_day <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">365</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>) {</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>        n_birthdays_per_day[day] <span class="ot">&lt;-</span> <span class="fu">sum</span>(birthdays <span class="sc">==</span> day)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    }</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">max</span>(n_birthdays_per_day) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>        match_vector[i] <span class="ot">&lt;-</span> <span class="st">&quot;birthdays match&quot;</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>        match_vector[i] <span class="ot">&lt;-</span> <span class="st">&quot;all unique&quot;</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    }</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>}</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>p_match <span class="ot">&lt;-</span> <span class="fu">sum</span>(match_vector <span class="sc">==</span> <span class="st">&quot;birthdays match&quot;</span>) <span class="sc">/</span> <span class="fu">length</span>(match_vector)</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>p_match</span></code></pre></div>
<pre><code>## [1] 0.489</code></pre>
</div>
<div class="slide section level2">

<p>Since we will want to use this code many times and run it for
different values of <code>n_people</code>, we can write a function that
takes <code>n_people</code> as an argument.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>do_birthdays_match <span class="ot">&lt;-</span> <span class="cf">function</span>(n_people) {</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    birthdays <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, <span class="at">size =</span> n_people, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    n_birthdays_per_day <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">365</span>)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>) {</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>        n_birthdays_per_day[day] <span class="ot">&lt;-</span> <span class="fu">sum</span>(birthdays <span class="sc">==</span> day)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    }</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">max</span>(n_birthdays_per_day) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">&quot;birthdays match&quot;</span>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">&quot;all unique&quot;</span>)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    }</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="slide section level2">

<p>Once we have this, we can write a more readable function that
estimates the probability of a match.</p>
<div class="incremental">
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>estimate_birthday_match_probability <span class="ot">&lt;-</span> <span class="cf">function</span>(n_people, <span class="at">n_sim =</span> <span class="dv">1000</span>) {</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    match_vector <span class="ot">&lt;-</span> <span class="fu">character</span>(n_sim)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>        match_vector[i] <span class="ot">&lt;-</span> <span class="fu">do_birthdays_match</span>(n_people)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    }</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    p_match <span class="ot">&lt;-</span> <span class="fu">sum</span>(match_vector <span class="sc">==</span> <span class="st">&quot;birthdays match&quot;</span>) <span class="sc">/</span> <span class="fu">length</span>(match_vector)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="fu">return</span>(p_match)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>}</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="fu">estimate_birthday_match_probability</span>(<span class="at">n_people =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">estimate_birthday_match_probability</span>(<span class="at">n_people =</span> <span class="dv">23</span>)</span></code></pre></div>
<pre><code>## [1] 0.513</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">estimate_birthday_match_probability</span>(<span class="at">n_people =</span> <span class="dv">366</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
</div>
<div id="a-more-complicated-problem" class="slide section level2">
<h1>A more complicated problem</h1>
<p>The initial formulation of the birthday problem assumes that every
birthday is equally likely.</p>
<p>We know this isn’t true though: more babies are born on weekdays, and
they tend not to be born on major holidays.</p>
<p>Finding the solution to the birthday problem with unequal birthday
probabilities is a hard problem for the probabilists, but easy for
us.</p>
</div>
<div class="slide section level2">

<p>Step 1: Modify simulation function to sample birthdays with unequal
probabilities</p>
<p>Remember the old version:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>do_birthdays_match <span class="ot">&lt;-</span> <span class="cf">function</span>(n_people) {</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    birthdays <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, <span class="at">size =</span> n_people, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    n_birthdays_per_day <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">365</span>)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>) {</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>        n_birthdays_per_day[day] <span class="ot">&lt;-</span> <span class="fu">sum</span>(birthdays <span class="sc">==</span> day)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    }</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">max</span>(n_birthdays_per_day) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">&quot;birthdays match&quot;</span>)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">&quot;all unique&quot;</span>)</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>    }</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>}</span></code></pre></div>
<div class="incremental">
<p>We can add another argument, giving the probability of each day of
the year:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>do_birthdays_match <span class="ot">&lt;-</span> <span class="cf">function</span>(n_people, birthday_probabilities) {</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>    birthdays <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(birthday_probabilities),</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>                        <span class="at">size =</span> n_people,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>                        <span class="at">prob =</span> birthday_probabilities,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>                        <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    n_birthdays_per_day <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">365</span>)</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>) {</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>        n_birthdays_per_day[day] <span class="ot">&lt;-</span> <span class="fu">sum</span>(birthdays <span class="sc">==</span> day)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>    }</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">max</span>(n_birthdays_per_day) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">&quot;birthdays match&quot;</span>)</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">&quot;all unique&quot;</span>)</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>    }</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">do_birthdays_match</span>(<span class="at">n_people =</span> <span class="dv">23</span>, <span class="at">birthday_probabilities =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">364</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;birthdays match&quot;</code></pre>
</div>
</div>
<div class="slide section level2">

<p>We can add the same argument to our probability estimation
function:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>estimate_birthday_match_probability <span class="ot">&lt;-</span> <span class="cf">function</span>(n_people, birthday_probabilities, <span class="at">n_sim =</span> <span class="dv">1000</span>) {</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    match_vector <span class="ot">&lt;-</span> <span class="fu">character</span>(n_sim)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>        match_vector[i] <span class="ot">&lt;-</span> <span class="fu">do_birthdays_match</span>(n_people, birthday_probabilities)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>    }</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>    p_match <span class="ot">&lt;-</span> <span class="fu">sum</span>(match_vector <span class="sc">==</span> <span class="st">&quot;birthdays match&quot;</span>) <span class="sc">/</span> <span class="fu">length</span>(match_vector)</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>    <span class="fu">return</span>(p_match)</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>}</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>uniform_birthday_probs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">365</span>, <span class="dv">365</span>)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>weekend_vs_weekday_likelihoods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>nonuniform_birthday_likelihoods <span class="ot">&lt;-</span> <span class="fu">rep</span>(weekend_vs_weekday_likelihoods, <span class="at">length.out =</span> <span class="dv">365</span>)</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>nonuniform_birthday_probs <span class="ot">&lt;-</span> nonuniform_birthday_likelihoods <span class="sc">/</span> <span class="fu">sum</span>(nonuniform_birthday_likelihoods)</span></code></pre></div>
<div class="incremental">
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">estimate_birthday_match_probability</span>(<span class="at">n_people =</span> <span class="dv">23</span>,</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>                                    <span class="at">birthday_probabilities =</span> uniform_birthday_probs,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>                                    <span class="at">n_sim =</span> <span class="dv">10000</span>)</span></code></pre></div>
<pre><code>## [1] 0.5092</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">estimate_birthday_match_probability</span>(<span class="at">n_people =</span> <span class="dv">23</span>,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>                                    <span class="at">birthday_probabilities =</span> nonuniform_birthday_probs,</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>                                    <span class="at">n_sim =</span> <span class="dv">10000</span>)</span></code></pre></div>
<pre><code>## [1] 0.5291</code></pre>
</div>
</div>
<div id="another-example-data-import" class="slide section level2">
<h1>Another example: Data import</h1>
<p>We are trying to import data from the CDC’s infant mortality records
(<a
href="https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/DVS/cohortlinkedus/LinkCO15US.zip">zipped
data</a>, <a
href="https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/DVS/cohortlinked/LinkCO15Guide.pdf">data
description</a>)</p>
<p>The data file consists of lines of characters, each of the same
length.</p>
<p>Variables are given by their position within the line, e.g. the
four-digit birth year is at indices 9-12, the two-digit age of the
mother is at indices 75-76, and so on.</p>
<p>We need to write our own functions to extract any variables we want
to work with.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;VS15LKBC.PublicUse.USNUMPUB_2019_11_25&quot;</span>)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="do">## we want to separate all the characters into individual elements</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>separated <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(<span class="at">x =</span> num[,<span class="dv">1</span>], <span class="at">split =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(separated)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>char_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>                     <span class="at">nrow =</span> <span class="fu">length</span>(separated),</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>                     <span class="at">ncol =</span> <span class="fu">length</span>(separated[[<span class="dv">1</span>]]))</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(separated)) {</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>    char_matrix[i,] <span class="ot">&lt;-</span> separated[[i]]</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>}</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="do">## extract birth year, in indices 9:12</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>birth_year <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(char_matrix)) {</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>    birth_year[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(char_matrix[i, <span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>], <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>}</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a><span class="fu">table</span>(birth_year)</span></code></pre></div>
<pre><code>## birth_year
##  2015 
## 23356</code></pre>
</div>
<div class="slide section level2">

<p>Suppose we want to be able to extract a lot of different variables.
It makes sense to create a function.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>extract_variable <span class="ot">&lt;-</span> <span class="cf">function</span>(start_idx, end_idx, mat, <span class="at">numeric =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>    <span class="do">## this is the character version of the variable</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    variable_char <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(char_matrix)) {</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>        variable_char[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(mat[i, start_idx<span class="sc">:</span>end_idx, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    }</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    <span class="do">## if we need to change the character to numeric, we do so</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>    <span class="cf">if</span>(numeric) {</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>        variable_numeric <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(variable_char)</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>        <span class="fu">return</span>(variable_numeric)</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>    }</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>    <span class="fu">return</span>(variable_char)</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>}</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>birth_year <span class="ot">&lt;-</span> <span class="fu">extract_variable</span>(<span class="dv">9</span>, <span class="dv">12</span>, char_matrix)</span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>mothers_age <span class="ot">&lt;-</span> <span class="fu">extract_variable</span>(<span class="dv">75</span>, <span class="dv">76</span>, char_matrix)</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="fu">summary</span>(birth_year)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    2015    2015    2015    2015    2015    2015</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">summary</span>(mothers_age)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   12.00   23.00   27.00   27.85   32.00   50.00</code></pre>
</div>
<div class="slide section level2">

<p>We later learn that some of the variables use specific numbers
(e.g. 9, 99, 999) as NA values. We might want to modify our function to
deal with these.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>extract_variable <span class="ot">&lt;-</span> <span class="cf">function</span>(start_idx, end_idx, mat,</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>                            <span class="at">numeric =</span> <span class="cn">TRUE</span>, <span class="at">na.val =</span> <span class="cn">NULL</span>) {</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>    variable_char <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(char_matrix)) {</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>        variable_char[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(mat[i, start_idx<span class="sc">:</span>end_idx, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>    }</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>    <span class="do">## if we need to change the character to numeric, we do so</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>    <span class="cf">if</span>(numeric) {</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>        variable_numeric <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(variable_char)</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(na.val)) {</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>            variable_numeric[variable_numeric <span class="sc">==</span> na.val] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>        }</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>        <span class="fu">return</span>(variable_numeric)</span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>    }</span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>    <span class="fu">return</span>(variable_char)</span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>}</span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>birth_year <span class="ot">&lt;-</span> <span class="fu">extract_variable</span>(<span class="dv">9</span>, <span class="dv">12</span>, char_matrix)</span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a><span class="fu">summary</span>(birth_year)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    2015    2015    2015    2015    2015    2015</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>mothers_age <span class="ot">&lt;-</span> <span class="fu">extract_variable</span>(<span class="dv">75</span>, <span class="dv">76</span>, char_matrix)</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="fu">summary</span>(mothers_age)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   12.00   23.00   27.00   27.85   32.00   50.00</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>gest_age <span class="ot">&lt;-</span> <span class="fu">extract_variable</span>(<span class="dv">492</span>, <span class="dv">493</span>, char_matrix, <span class="at">na.val =</span> <span class="dv">99</span>)</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="fu">summary</span>(gest_age)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   1.000   2.000   3.000   4.147   6.000  10.000     204</code></pre>
</div>
<div class="slide section level2">

<p>From the end of Chapter 3 of <em>Clean Code</em>:</p>
<blockquote>
<p>Master programmers think of systems as stories to be told rather than
programs to be written.</p>
</blockquote>
<blockquote>
<p>They use the facilities of their chosen programming language to
construct a much richer and more expressive language that can be used to
tell that story.</p>
</blockquote>
<blockquote>
<p>Part of that domain-specific language is the hierarchy of functions
that describe all the actions that take place within that system.</p>
</blockquote>
<blockquote>
<p>In an artful act of recursion those actions are written to use the
very domain-specific language they define to tell their own small part
of the story.</p>
</blockquote>
</div>
</body>
</html>
